"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fc = require("fast-check");
const statement_1 = require("../../lib/iam/statement");
test('can parse all positive fields', () => {
    const statement = new statement_1.Statement({
        Sid: 'Sid',
        Effect: 'Allow',
        Resource: ['resource'],
        Action: ['action'],
        Principal: [{ AWS: 'arn' }],
        Condition: { StringEquals: { 'Amzn-This': 'That' } },
    });
    expect(statement.sid).toEqual('Sid');
    expect(statement.effect).toEqual('Allow');
    expect(statement.resources.values).toEqual(['resource']);
    expect(statement.actions.values).toEqual(['action']);
    expect(statement.principals.values).toEqual(['AWS:arn']);
    expect(statement.condition).toEqual({ StringEquals: { 'Amzn-This': 'That' } });
    expect(statement.resources.not).toBe(false);
    expect(statement.actions.not).toBe(false);
    expect(statement.principals.not).toBe(false);
});
test('parses strings as singleton lists', () => {
    const statement = new statement_1.Statement({
        Resource: 'resource',
    });
    expect(statement.resources.values).toEqual(['resource']);
});
test('correctly parses NotFields', () => {
    const statement = new statement_1.Statement({
        NotResource: ['resource'],
        NotAction: ['action'],
        NotPrincipal: [{ AWS: 'arn' }],
    });
    expect(statement.resources.not).toBe(true);
    expect(statement.actions.not).toBe(true);
    expect(statement.principals.not).toBe(true);
});
test('parse all LambdaPermission fields', () => {
    const statement = statement_1.parseLambdaPermission({
        Action: 'lambda:CallMeMaybe',
        FunctionName: 'Function',
        Principal: '*',
        SourceAccount: '123456789012',
        SourceArn: 'arn',
    });
    expect(statement.actions.values).toEqual(['lambda:CallMeMaybe']);
    expect(statement.resources.values).toEqual(['Function']);
    expect(statement.principals.values).toEqual(['*']);
    expect(statement.condition).toEqual({
        ArnLike: { 'AWS:SourceArn': 'arn' },
        StringEquals: { 'AWS:SourceAccount': '123456789012' },
    });
});
test('parse lambda eventsourcetoken', () => {
    const statement = statement_1.parseLambdaPermission({
        Action: 'lambda:CallMeMaybe',
        FunctionName: 'Function',
        EventSourceToken: 'token',
        Principal: '*',
    });
    expect(statement.condition).toEqual({
        StringEquals: { 'lambda:EventSourceToken': 'token' },
    });
});
test('stringify complex condition', () => {
    // WHEN
    const stringified = statement_1.renderCondition({
        StringEquals: { 'AWS:SourceAccount': '${AWS::AccountId}' },
        ArnLike: { 'AWS:SourceArn': '${MyBucket.Arn}' },
    }).split('\n');
    // THEN
    expect(stringified).toEqual([
        '"StringEquals": {',
        '  "AWS:SourceAccount": "${AWS::AccountId}"',
        '},',
        '"ArnLike": {',
        '  "AWS:SourceArn": "${MyBucket.Arn}"',
        '}',
    ]);
});
test('an Allow statement with a NotPrincipal is negative', () => {
    // WHEN
    const statement = new statement_1.Statement({
        Effect: 'Allow',
        Resource: 'resource',
        NotPrincipal: { AWS: 'me' },
    });
    // THEN
    expect(statement.isNegativeStatement).toBe(true);
});
test('a Deny statement with a NotPrincipal is positive', () => {
    // In effect, this is a roundabout way of saying only the given Principal
    // should be allowed ("everyone who's not me can't do this").
    // WHEN
    const statement = new statement_1.Statement({
        Effect: 'Deny',
        Resource: 'resource',
        NotPrincipal: { AWS: 'me' },
    });
    // THEN
    expect(statement.isNegativeStatement).toBe(false);
});
test('equality is reflexive', () => {
    fc.assert(fc.property(arbitraryStatement, (statement) => {
        return new statement_1.Statement(statement).equal(new statement_1.Statement(statement));
    }));
});
test('equality is symmetric', () => {
    fc.assert(fc.property(twoArbitraryStatements, (s) => {
        const a = new statement_1.Statement(s.statement1);
        const b = new statement_1.Statement(s.statement2);
        fc.pre(a.equal(b));
        return b.equal(a);
    }));
});
// We should be testing transitivity as well but it's too much code to generate
// arbitraries that satisfy the precondition enough times to be useful.
const arbitraryResource = fc.oneof(fc.constantFrom('*', 'arn:resource'));
const arbitraryAction = fc.constantFrom('*', 's3:*', 's3:GetObject', 's3:PutObject');
const arbitraryPrincipal = fc.oneof(fc.constant(undefined), fc.constant('*'), fc.record({ AWS: fc.oneof(fc.string(), fc.constant('*')) }), fc.record({ Service: fc.string() }), fc.record({ Federated: fc.string() }));
const arbitraryCondition = fc.oneof(fc.constant(undefined), fc.constant({ StringEquals: { Key: 'Value' } }), fc.constant({ StringEquals: { Key: 'Value' }, NumberEquals: { Key: 5 } }));
const arbitraryStatement = fc.record({
    Sid: fc.oneof(fc.string(), fc.constant(undefined)),
    Effect: fc.constantFrom('Allow', 'Deny'),
    Resource: fc.array(arbitraryResource, 0, 2),
    NotResource: fc.boolean(),
    Action: fc.array(arbitraryAction, 1, 2),
    NotAction: fc.boolean(),
    Principal: fc.array(arbitraryPrincipal, 0, 2),
    NotPrincipal: fc.boolean(),
    Condition: arbitraryCondition,
}).map(record => {
    // This map() that shuffles keys is the easiest way to create variation between Action/NotAction etc.
    makeNot(record, 'Resource', 'NotResource');
    makeNot(record, 'Action', 'NotAction');
    makeNot(record, 'Principal', 'NotPrincipal');
    return record;
});
function makeNot(obj, key, notKey) {
    if (obj[notKey]) {
        obj[notKey] = obj[key];
        delete obj[key];
    }
    else {
        delete obj[notKey];
    }
}
/**
 * Two statements where one is a modification of the other
 *
 * This is to generate two statements that have a higher chance of being similar
 * than generating two arbitrary statements independently.
 */
const twoArbitraryStatements = fc.record({
    statement1: arbitraryStatement,
    statement2: arbitraryStatement,
    copySid: fc.boolean(),
    copyEffect: fc.boolean(),
    copyResource: fc.boolean(),
    copyAction: fc.boolean(),
    copyPrincipal: fc.boolean(),
    copyCondition: fc.boolean(),
}).map(op => {
    const original = op.statement1;
    const modified = Object.create(original, {});
    if (op.copySid) {
        modified.Sid = op.statement2.Sid;
    }
    if (op.copyEffect) {
        modified.Effect = op.statement2.Effect;
    }
    if (op.copyResource) {
        modified.Resource = op.statement2.Resource;
        modified.NotResource = op.statement2.NotResource;
    }
    if (op.copyAction) {
        modified.Action = op.statement2.Action;
        modified.NotAction = op.statement2.NotAction;
    }
    if (op.copyPrincipal) {
        modified.Principal = op.statement2.Principal;
        modified.NotPrincipal = op.statement2.NotPrincipal;
    }
    if (op.copyCondition) {
        modified.Condition = op.statement2.Condition;
    }
    return { statement1: original, statement2: modified };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGVtZW50LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzdGF0ZW1lbnQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGlDQUFpQztBQUNqQyx1REFBNEY7QUFFNUYsSUFBSSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxNQUFNLFNBQVMsR0FBRyxJQUFJLHFCQUFTLENBQUM7UUFDOUIsR0FBRyxFQUFFLEtBQUs7UUFDVixNQUFNLEVBQUUsT0FBTztRQUNmLFFBQVEsRUFBRSxDQUFDLFVBQVUsQ0FBQztRQUN0QixNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUM7UUFDbEIsU0FBUyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUM7UUFDM0IsU0FBUyxFQUFFLEVBQUUsWUFBWSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxFQUFFO0tBQ3JELENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDekQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ3pELE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsWUFBWSxFQUFFLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztJQUUvRSxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMvQyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7SUFDN0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxxQkFBUyxDQUFDO1FBQzlCLFFBQVEsRUFBRSxVQUFVO0tBQ3JCLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7QUFDM0QsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO0lBQ3RDLE1BQU0sU0FBUyxHQUFHLElBQUkscUJBQVMsQ0FBQztRQUM5QixXQUFXLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFDekIsU0FBUyxFQUFFLENBQUMsUUFBUSxDQUFDO1FBQ3JCLFlBQVksRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDO0tBQy9CLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQyxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlDLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtJQUM3QyxNQUFNLFNBQVMsR0FBRyxpQ0FBcUIsQ0FBQztRQUN0QyxNQUFNLEVBQUUsb0JBQW9CO1FBQzVCLFlBQVksRUFBRSxVQUFVO1FBQ3hCLFNBQVMsRUFBRSxHQUFHO1FBQ2QsYUFBYSxFQUFFLGNBQWM7UUFDN0IsU0FBUyxFQUFFLEtBQUs7S0FDakIsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDekQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNuRCxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUNsQyxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFO1FBQ25DLFlBQVksRUFBRSxFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRTtLQUN0RCxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7SUFDekMsTUFBTSxTQUFTLEdBQUcsaUNBQXFCLENBQUM7UUFDdEMsTUFBTSxFQUFFLG9CQUFvQjtRQUM1QixZQUFZLEVBQUUsVUFBVTtRQUN4QixnQkFBZ0IsRUFBRSxPQUFPO1FBQ3pCLFNBQVMsRUFBRSxHQUFHO0tBQ2YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDbEMsWUFBWSxFQUFFLEVBQUUseUJBQXlCLEVBQUUsT0FBTyxFQUFFO0tBQ3JELENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUN2QyxPQUFPO0lBQ1AsTUFBTSxXQUFXLEdBQUcsMkJBQWUsQ0FBQztRQUNsQyxZQUFZLEVBQUUsRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsRUFBRTtRQUMxRCxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsaUJBQWlCLEVBQUU7S0FDaEQsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVmLE9BQU87SUFDUCxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQzFCLG1CQUFtQjtRQUNuQiw0Q0FBNEM7UUFDNUMsSUFBSTtRQUNKLGNBQWM7UUFDZCxzQ0FBc0M7UUFDdEMsR0FBRztLQUNKLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtJQUM5RCxPQUFPO0lBQ1AsTUFBTSxTQUFTLEdBQUcsSUFBSSxxQkFBUyxDQUFDO1FBQzlCLE1BQU0sRUFBRSxPQUFPO1FBQ2YsUUFBUSxFQUFFLFVBQVU7UUFDcEIsWUFBWSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRTtLQUM1QixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNuRCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxrREFBa0QsRUFBRSxHQUFHLEVBQUU7SUFDNUQseUVBQXlFO0lBQ3pFLDZEQUE2RDtJQUU3RCxPQUFPO0lBQ1AsTUFBTSxTQUFTLEdBQUcsSUFBSSxxQkFBUyxDQUFDO1FBQzlCLE1BQU0sRUFBRSxNQUFNO1FBQ2QsUUFBUSxFQUFFLFVBQVU7UUFDcEIsWUFBWSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRTtLQUM1QixDQUFDLENBQUM7SUFFSCxPQUFPO0lBQ1AsTUFBTSxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUNuQixrQkFBa0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFO1FBQ2hDLE9BQU8sSUFBSSxxQkFBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLHFCQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNsRSxDQUFDLENBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ2pDLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FDbkIsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUM1QixNQUFNLENBQUMsR0FBRyxJQUFJLHFCQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxHQUFHLElBQUkscUJBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFdEMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkIsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BCLENBQUMsQ0FDRixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILCtFQUErRTtBQUMvRSx1RUFBdUU7QUFFdkUsTUFBTSxpQkFBaUIsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7QUFDekUsTUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztBQUNyRixNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQ2pDLEVBQUUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQ3RCLEVBQUUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQ2hCLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDM0QsRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUNuQyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQ3RDLENBQUM7QUFDRixNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQ2pDLEVBQUUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQ3RCLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxZQUFZLEVBQUUsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxFQUMvQyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsWUFBWSxFQUFFLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQzFFLENBQUM7QUFFRixNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDbkMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEQsTUFBTSxFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQztJQUN4QyxRQUFRLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLFdBQVcsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQ3pCLE1BQU0sRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLFNBQVMsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQ3ZCLFNBQVMsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLGtCQUFrQixFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0MsWUFBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLEVBQUU7SUFDMUIsU0FBUyxFQUFFLGtCQUFrQjtDQUM5QixDQUFDLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFO0lBQ2QscUdBQXFHO0lBQ3JHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzNDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3ZDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQzdDLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxPQUFPLENBQUMsR0FBUSxFQUFFLEdBQVcsRUFBRSxNQUFjO0lBQ3BELElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ2YsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2QixPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNqQjtTQUFNO1FBQ0wsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDcEI7QUFDSCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLHNCQUFzQixHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUM7SUFDdkMsVUFBVSxFQUFFLGtCQUFrQjtJQUM5QixVQUFVLEVBQUUsa0JBQWtCO0lBQzlCLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQ3JCLFVBQVUsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQ3hCLFlBQVksRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQzFCLFVBQVUsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQ3hCLGFBQWEsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0lBQzNCLGFBQWEsRUFBRSxFQUFFLENBQUMsT0FBTyxFQUFFO0NBQzVCLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7SUFDVixNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDO0lBQy9CLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRTdDLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRTtRQUFFLFFBQVEsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUM7S0FBRTtJQUNyRCxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUU7UUFBRSxRQUFRLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO0tBQUU7SUFDOUQsSUFBSSxFQUFFLENBQUMsWUFBWSxFQUFFO1FBQUUsUUFBUSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQztRQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7S0FBRTtJQUN0SCxJQUFJLEVBQUUsQ0FBQyxVQUFVLEVBQUU7UUFBRSxRQUFRLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQUMsUUFBUSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQztLQUFFO0lBQzVHLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBRTtRQUFFLFFBQVEsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFBQyxRQUFRLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO0tBQUU7SUFDM0gsSUFBSSxFQUFFLENBQUMsYUFBYSxFQUFFO1FBQUUsUUFBUSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQztLQUFFO0lBRXZFLE9BQU8sRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQztBQUN4RCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZjIGZyb20gJ2Zhc3QtY2hlY2snO1xuaW1wb3J0IHsgcGFyc2VMYW1iZGFQZXJtaXNzaW9uLCByZW5kZXJDb25kaXRpb24sIFN0YXRlbWVudCB9IGZyb20gJy4uLy4uL2xpYi9pYW0vc3RhdGVtZW50JztcblxudGVzdCgnY2FuIHBhcnNlIGFsbCBwb3NpdGl2ZSBmaWVsZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IG5ldyBTdGF0ZW1lbnQoe1xuICAgIFNpZDogJ1NpZCcsXG4gICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgIFJlc291cmNlOiBbJ3Jlc291cmNlJ10sXG4gICAgQWN0aW9uOiBbJ2FjdGlvbiddLFxuICAgIFByaW5jaXBhbDogW3sgQVdTOiAnYXJuJyB9XSxcbiAgICBDb25kaXRpb246IHsgU3RyaW5nRXF1YWxzOiB7ICdBbXpuLVRoaXMnOiAnVGhhdCcgfSB9LFxuICB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LnNpZCkudG9FcXVhbCgnU2lkJyk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuZWZmZWN0KS50b0VxdWFsKCdBbGxvdycpO1xuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy52YWx1ZXMpLnRvRXF1YWwoWydyZXNvdXJjZSddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5hY3Rpb25zLnZhbHVlcykudG9FcXVhbChbJ2FjdGlvbiddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLnZhbHVlcykudG9FcXVhbChbJ0FXUzphcm4nXSk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuY29uZGl0aW9uKS50b0VxdWFsKHsgU3RyaW5nRXF1YWxzOiB7ICdBbXpuLVRoaXMnOiAnVGhhdCcgfSB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy5ub3QpLnRvQmUoZmFsc2UpO1xuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMubm90KS50b0JlKGZhbHNlKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLm5vdCkudG9CZShmYWxzZSk7XG59KTtcblxudGVzdCgncGFyc2VzIHN0cmluZ3MgYXMgc2luZ2xldG9uIGxpc3RzJywgKCkgPT4ge1xuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBSZXNvdXJjZTogJ3Jlc291cmNlJyxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5yZXNvdXJjZXMudmFsdWVzKS50b0VxdWFsKFsncmVzb3VyY2UnXSk7XG59KTtcblxudGVzdCgnY29ycmVjdGx5IHBhcnNlcyBOb3RGaWVsZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IG5ldyBTdGF0ZW1lbnQoe1xuICAgIE5vdFJlc291cmNlOiBbJ3Jlc291cmNlJ10sXG4gICAgTm90QWN0aW9uOiBbJ2FjdGlvbiddLFxuICAgIE5vdFByaW5jaXBhbDogW3sgQVdTOiAnYXJuJyB9XSxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5yZXNvdXJjZXMubm90KS50b0JlKHRydWUpO1xuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMubm90KS50b0JlKHRydWUpO1xuICBleHBlY3Qoc3RhdGVtZW50LnByaW5jaXBhbHMubm90KS50b0JlKHRydWUpO1xufSk7XG5cbnRlc3QoJ3BhcnNlIGFsbCBMYW1iZGFQZXJtaXNzaW9uIGZpZWxkcycsICgpID0+IHtcbiAgY29uc3Qgc3RhdGVtZW50ID0gcGFyc2VMYW1iZGFQZXJtaXNzaW9uKHtcbiAgICBBY3Rpb246ICdsYW1iZGE6Q2FsbE1lTWF5YmUnLFxuICAgIEZ1bmN0aW9uTmFtZTogJ0Z1bmN0aW9uJyxcbiAgICBQcmluY2lwYWw6ICcqJyxcbiAgICBTb3VyY2VBY2NvdW50OiAnMTIzNDU2Nzg5MDEyJyxcbiAgICBTb3VyY2VBcm46ICdhcm4nLFxuICB9KTtcblxuICBleHBlY3Qoc3RhdGVtZW50LmFjdGlvbnMudmFsdWVzKS50b0VxdWFsKFsnbGFtYmRhOkNhbGxNZU1heWJlJ10pO1xuICBleHBlY3Qoc3RhdGVtZW50LnJlc291cmNlcy52YWx1ZXMpLnRvRXF1YWwoWydGdW5jdGlvbiddKTtcbiAgZXhwZWN0KHN0YXRlbWVudC5wcmluY2lwYWxzLnZhbHVlcykudG9FcXVhbChbJyonXSk7XG4gIGV4cGVjdChzdGF0ZW1lbnQuY29uZGl0aW9uKS50b0VxdWFsKHtcbiAgICBBcm5MaWtlOiB7ICdBV1M6U291cmNlQXJuJzogJ2FybicgfSxcbiAgICBTdHJpbmdFcXVhbHM6IHsgJ0FXUzpTb3VyY2VBY2NvdW50JzogJzEyMzQ1Njc4OTAxMicgfSxcbiAgfSk7XG59KTtcblxudGVzdCgncGFyc2UgbGFtYmRhIGV2ZW50c291cmNldG9rZW4nLCAoKSA9PiB7XG4gIGNvbnN0IHN0YXRlbWVudCA9IHBhcnNlTGFtYmRhUGVybWlzc2lvbih7XG4gICAgQWN0aW9uOiAnbGFtYmRhOkNhbGxNZU1heWJlJyxcbiAgICBGdW5jdGlvbk5hbWU6ICdGdW5jdGlvbicsXG4gICAgRXZlbnRTb3VyY2VUb2tlbjogJ3Rva2VuJyxcbiAgICBQcmluY2lwYWw6ICcqJyxcbiAgfSk7XG5cbiAgZXhwZWN0KHN0YXRlbWVudC5jb25kaXRpb24pLnRvRXF1YWwoe1xuICAgIFN0cmluZ0VxdWFsczogeyAnbGFtYmRhOkV2ZW50U291cmNlVG9rZW4nOiAndG9rZW4nIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3N0cmluZ2lmeSBjb21wbGV4IGNvbmRpdGlvbicsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBzdHJpbmdpZmllZCA9IHJlbmRlckNvbmRpdGlvbih7XG4gICAgU3RyaW5nRXF1YWxzOiB7ICdBV1M6U291cmNlQWNjb3VudCc6ICcke0FXUzo6QWNjb3VudElkfScgfSxcbiAgICBBcm5MaWtlOiB7ICdBV1M6U291cmNlQXJuJzogJyR7TXlCdWNrZXQuQXJufScgfSxcbiAgfSkuc3BsaXQoJ1xcbicpO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0cmluZ2lmaWVkKS50b0VxdWFsKFtcbiAgICAnXCJTdHJpbmdFcXVhbHNcIjogeycsXG4gICAgJyAgXCJBV1M6U291cmNlQWNjb3VudFwiOiBcIiR7QVdTOjpBY2NvdW50SWR9XCInLFxuICAgICd9LCcsXG4gICAgJ1wiQXJuTGlrZVwiOiB7JyxcbiAgICAnICBcIkFXUzpTb3VyY2VBcm5cIjogXCIke015QnVja2V0LkFybn1cIicsXG4gICAgJ30nLFxuICBdKTtcbn0pO1xuXG50ZXN0KCdhbiBBbGxvdyBzdGF0ZW1lbnQgd2l0aCBhIE5vdFByaW5jaXBhbCBpcyBuZWdhdGl2ZScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgUmVzb3VyY2U6ICdyZXNvdXJjZScsXG4gICAgTm90UHJpbmNpcGFsOiB7IEFXUzogJ21lJyB9LFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChzdGF0ZW1lbnQuaXNOZWdhdGl2ZVN0YXRlbWVudCkudG9CZSh0cnVlKTtcbn0pO1xuXG50ZXN0KCdhIERlbnkgc3RhdGVtZW50IHdpdGggYSBOb3RQcmluY2lwYWwgaXMgcG9zaXRpdmUnLCAoKSA9PiB7XG4gIC8vIEluIGVmZmVjdCwgdGhpcyBpcyBhIHJvdW5kYWJvdXQgd2F5IG9mIHNheWluZyBvbmx5IHRoZSBnaXZlbiBQcmluY2lwYWxcbiAgLy8gc2hvdWxkIGJlIGFsbG93ZWQgKFwiZXZlcnlvbmUgd2hvJ3Mgbm90IG1lIGNhbid0IGRvIHRoaXNcIikuXG5cbiAgLy8gV0hFTlxuICBjb25zdCBzdGF0ZW1lbnQgPSBuZXcgU3RhdGVtZW50KHtcbiAgICBFZmZlY3Q6ICdEZW55JyxcbiAgICBSZXNvdXJjZTogJ3Jlc291cmNlJyxcbiAgICBOb3RQcmluY2lwYWw6IHsgQVdTOiAnbWUnIH0sXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KHN0YXRlbWVudC5pc05lZ2F0aXZlU3RhdGVtZW50KS50b0JlKGZhbHNlKTtcbn0pO1xuXG50ZXN0KCdlcXVhbGl0eSBpcyByZWZsZXhpdmUnLCAoKSA9PiB7XG4gIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICBhcmJpdHJhcnlTdGF0ZW1lbnQsIChzdGF0ZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiBuZXcgU3RhdGVtZW50KHN0YXRlbWVudCkuZXF1YWwobmV3IFN0YXRlbWVudChzdGF0ZW1lbnQpKTtcbiAgICB9LFxuICApKTtcbn0pO1xuXG50ZXN0KCdlcXVhbGl0eSBpcyBzeW1tZXRyaWMnLCAoKSA9PiB7XG4gIGZjLmFzc2VydChmYy5wcm9wZXJ0eShcbiAgICB0d29BcmJpdHJhcnlTdGF0ZW1lbnRzLCAocykgPT4ge1xuICAgICAgY29uc3QgYSA9IG5ldyBTdGF0ZW1lbnQocy5zdGF0ZW1lbnQxKTtcbiAgICAgIGNvbnN0IGIgPSBuZXcgU3RhdGVtZW50KHMuc3RhdGVtZW50Mik7XG5cbiAgICAgIGZjLnByZShhLmVxdWFsKGIpKTtcbiAgICAgIHJldHVybiBiLmVxdWFsKGEpO1xuICAgIH0sXG4gICkpO1xufSk7XG5cbi8vIFdlIHNob3VsZCBiZSB0ZXN0aW5nIHRyYW5zaXRpdml0eSBhcyB3ZWxsIGJ1dCBpdCdzIHRvbyBtdWNoIGNvZGUgdG8gZ2VuZXJhdGVcbi8vIGFyYml0cmFyaWVzIHRoYXQgc2F0aXNmeSB0aGUgcHJlY29uZGl0aW9uIGVub3VnaCB0aW1lcyB0byBiZSB1c2VmdWwuXG5cbmNvbnN0IGFyYml0cmFyeVJlc291cmNlID0gZmMub25lb2YoZmMuY29uc3RhbnRGcm9tKCcqJywgJ2FybjpyZXNvdXJjZScpKTtcbmNvbnN0IGFyYml0cmFyeUFjdGlvbiA9IGZjLmNvbnN0YW50RnJvbSgnKicsICdzMzoqJywgJ3MzOkdldE9iamVjdCcsICdzMzpQdXRPYmplY3QnKTtcbmNvbnN0IGFyYml0cmFyeVByaW5jaXBhbCA9IGZjLm9uZW9mPGFueT4oXG4gIGZjLmNvbnN0YW50KHVuZGVmaW5lZCksXG4gIGZjLmNvbnN0YW50KCcqJyksXG4gIGZjLnJlY29yZCh7IEFXUzogZmMub25lb2YoZmMuc3RyaW5nKCksIGZjLmNvbnN0YW50KCcqJykpIH0pLFxuICBmYy5yZWNvcmQoeyBTZXJ2aWNlOiBmYy5zdHJpbmcoKSB9KSxcbiAgZmMucmVjb3JkKHsgRmVkZXJhdGVkOiBmYy5zdHJpbmcoKSB9KSxcbik7XG5jb25zdCBhcmJpdHJhcnlDb25kaXRpb24gPSBmYy5vbmVvZihcbiAgZmMuY29uc3RhbnQodW5kZWZpbmVkKSxcbiAgZmMuY29uc3RhbnQoeyBTdHJpbmdFcXVhbHM6IHsgS2V5OiAnVmFsdWUnIH0gfSksXG4gIGZjLmNvbnN0YW50KHsgU3RyaW5nRXF1YWxzOiB7IEtleTogJ1ZhbHVlJyB9LCBOdW1iZXJFcXVhbHM6IHsgS2V5OiA1IH0gfSksXG4pO1xuXG5jb25zdCBhcmJpdHJhcnlTdGF0ZW1lbnQgPSBmYy5yZWNvcmQoe1xuICBTaWQ6IGZjLm9uZW9mKGZjLnN0cmluZygpLCBmYy5jb25zdGFudCh1bmRlZmluZWQpKSxcbiAgRWZmZWN0OiBmYy5jb25zdGFudEZyb20oJ0FsbG93JywgJ0RlbnknKSxcbiAgUmVzb3VyY2U6IGZjLmFycmF5KGFyYml0cmFyeVJlc291cmNlLCAwLCAyKSxcbiAgTm90UmVzb3VyY2U6IGZjLmJvb2xlYW4oKSxcbiAgQWN0aW9uOiBmYy5hcnJheShhcmJpdHJhcnlBY3Rpb24sIDEsIDIpLFxuICBOb3RBY3Rpb246IGZjLmJvb2xlYW4oKSxcbiAgUHJpbmNpcGFsOiBmYy5hcnJheShhcmJpdHJhcnlQcmluY2lwYWwsIDAsIDIpLFxuICBOb3RQcmluY2lwYWw6IGZjLmJvb2xlYW4oKSxcbiAgQ29uZGl0aW9uOiBhcmJpdHJhcnlDb25kaXRpb24sXG59KS5tYXAocmVjb3JkID0+IHtcbiAgLy8gVGhpcyBtYXAoKSB0aGF0IHNodWZmbGVzIGtleXMgaXMgdGhlIGVhc2llc3Qgd2F5IHRvIGNyZWF0ZSB2YXJpYXRpb24gYmV0d2VlbiBBY3Rpb24vTm90QWN0aW9uIGV0Yy5cbiAgbWFrZU5vdChyZWNvcmQsICdSZXNvdXJjZScsICdOb3RSZXNvdXJjZScpO1xuICBtYWtlTm90KHJlY29yZCwgJ0FjdGlvbicsICdOb3RBY3Rpb24nKTtcbiAgbWFrZU5vdChyZWNvcmQsICdQcmluY2lwYWwnLCAnTm90UHJpbmNpcGFsJyk7XG4gIHJldHVybiByZWNvcmQ7XG59KTtcblxuZnVuY3Rpb24gbWFrZU5vdChvYmo6IGFueSwga2V5OiBzdHJpbmcsIG5vdEtleTogc3RyaW5nKSB7XG4gIGlmIChvYmpbbm90S2V5XSkge1xuICAgIG9ialtub3RLZXldID0gb2JqW2tleV07XG4gICAgZGVsZXRlIG9ialtrZXldO1xuICB9IGVsc2Uge1xuICAgIGRlbGV0ZSBvYmpbbm90S2V5XTtcbiAgfVxufVxuXG4vKipcbiAqIFR3byBzdGF0ZW1lbnRzIHdoZXJlIG9uZSBpcyBhIG1vZGlmaWNhdGlvbiBvZiB0aGUgb3RoZXJcbiAqXG4gKiBUaGlzIGlzIHRvIGdlbmVyYXRlIHR3byBzdGF0ZW1lbnRzIHRoYXQgaGF2ZSBhIGhpZ2hlciBjaGFuY2Ugb2YgYmVpbmcgc2ltaWxhclxuICogdGhhbiBnZW5lcmF0aW5nIHR3byBhcmJpdHJhcnkgc3RhdGVtZW50cyBpbmRlcGVuZGVudGx5LlxuICovXG5jb25zdCB0d29BcmJpdHJhcnlTdGF0ZW1lbnRzID0gZmMucmVjb3JkKHtcbiAgc3RhdGVtZW50MTogYXJiaXRyYXJ5U3RhdGVtZW50LFxuICBzdGF0ZW1lbnQyOiBhcmJpdHJhcnlTdGF0ZW1lbnQsXG4gIGNvcHlTaWQ6IGZjLmJvb2xlYW4oKSxcbiAgY29weUVmZmVjdDogZmMuYm9vbGVhbigpLFxuICBjb3B5UmVzb3VyY2U6IGZjLmJvb2xlYW4oKSxcbiAgY29weUFjdGlvbjogZmMuYm9vbGVhbigpLFxuICBjb3B5UHJpbmNpcGFsOiBmYy5ib29sZWFuKCksXG4gIGNvcHlDb25kaXRpb246IGZjLmJvb2xlYW4oKSxcbn0pLm1hcChvcCA9PiB7XG4gIGNvbnN0IG9yaWdpbmFsID0gb3Auc3RhdGVtZW50MTtcbiAgY29uc3QgbW9kaWZpZWQgPSBPYmplY3QuY3JlYXRlKG9yaWdpbmFsLCB7fSk7XG5cbiAgaWYgKG9wLmNvcHlTaWQpIHsgbW9kaWZpZWQuU2lkID0gb3Auc3RhdGVtZW50Mi5TaWQ7IH1cbiAgaWYgKG9wLmNvcHlFZmZlY3QpIHsgbW9kaWZpZWQuRWZmZWN0ID0gb3Auc3RhdGVtZW50Mi5FZmZlY3Q7IH1cbiAgaWYgKG9wLmNvcHlSZXNvdXJjZSkgeyBtb2RpZmllZC5SZXNvdXJjZSA9IG9wLnN0YXRlbWVudDIuUmVzb3VyY2U7IG1vZGlmaWVkLk5vdFJlc291cmNlID0gb3Auc3RhdGVtZW50Mi5Ob3RSZXNvdXJjZTsgfVxuICBpZiAob3AuY29weUFjdGlvbikgeyBtb2RpZmllZC5BY3Rpb24gPSBvcC5zdGF0ZW1lbnQyLkFjdGlvbjsgbW9kaWZpZWQuTm90QWN0aW9uID0gb3Auc3RhdGVtZW50Mi5Ob3RBY3Rpb247IH1cbiAgaWYgKG9wLmNvcHlQcmluY2lwYWwpIHsgbW9kaWZpZWQuUHJpbmNpcGFsID0gb3Auc3RhdGVtZW50Mi5QcmluY2lwYWw7IG1vZGlmaWVkLk5vdFByaW5jaXBhbCA9IG9wLnN0YXRlbWVudDIuTm90UHJpbmNpcGFsOyB9XG4gIGlmIChvcC5jb3B5Q29uZGl0aW9uKSB7IG1vZGlmaWVkLkNvbmRpdGlvbiA9IG9wLnN0YXRlbWVudDIuQ29uZGl0aW9uOyB9XG5cbiAgcmV0dXJuIHsgc3RhdGVtZW50MTogb3JpZ2luYWwsIHN0YXRlbWVudDI6IG1vZGlmaWVkIH07XG59KTtcbiJdfQ==