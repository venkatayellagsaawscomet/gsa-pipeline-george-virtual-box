"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert_1 = require("@aws-cdk/assert");
const ec2 = require("@aws-cdk/aws-ec2");
const kms = require("@aws-cdk/aws-kms");
const core_1 = require("@aws-cdk/core");
const lib_1 = require("../lib");
let stack = new core_1.Stack();
let vpc = new ec2.Vpc(stack, 'VPC');
beforeEach(() => {
    stack = new core_1.Stack();
    vpc = new ec2.Vpc(stack, 'VPC');
});
test('default file system is created correctly', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        DeletionPolicy: 'Retain',
        UpdateReplacePolicy: 'Retain',
    }, assert_1.ResourcePart.CompleteDefinition));
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::MountTarget'));
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EC2::SecurityGroup'));
});
test('unencrypted file system is created correctly with default KMS', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        encrypted: false,
    });
    // THEN
    assert_1.expect(stack).notTo(assert_1.haveResource('AWS::EFS::FileSystem', {
        Encrypted: true,
    }));
});
test('encrypted file system is created correctly with default KMS', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        encrypted: true,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        Encrypted: true,
    }));
});
test('encrypted file system is created correctly with custom KMS', () => {
    const key = new kms.Key(stack, 'customKeyFS');
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        encrypted: true,
        kmsKey: key,
    });
    // THEN
    /*
     * CDK appends 8-digit MD5 hash of the resource path to the logical Id of the resource in order to make sure
     * that the id is unique across multiple stacks. There isnt a direct way to identify the exact name of the resource
     * in generated CDK, hence hardcoding the MD5 hash here for assertion. Assumption is that the path of the Key wont
     * change in this UT. Checked the unique id by generating the cloud formation stack.
     */
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        Encrypted: true,
        KmsKeyId: {
            Ref: 'customKeyFSDDB87C6D',
        },
    }));
});
test('file system is created correctly with a life cycle property', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        lifecyclePolicy: lib_1.LifecyclePolicy.AFTER_7_DAYS,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        LifecyclePolicies: [{
                TransitionToIA: 'AFTER_7_DAYS',
            }],
    }));
});
test('file system is created correctly with performance mode', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        performanceMode: lib_1.PerformanceMode.MAX_IO,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        PerformanceMode: 'maxIO',
    }));
});
test('file system is created correctly with bursting throughput mode', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        throughputMode: lib_1.ThroughputMode.BURSTING,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        ThroughputMode: 'bursting',
    }));
});
test('Exception when throughput mode is set to PROVISIONED, but provisioned throughput is not set', () => {
    expect(() => {
        new lib_1.FileSystem(stack, 'EfsFileSystem', {
            vpc,
            throughputMode: lib_1.ThroughputMode.PROVISIONED,
        });
    }).toThrowError(/Property provisionedThroughputPerSecond is required when throughputMode is PROVISIONED/);
});
test('fails when provisioned throughput is less than the valid range', () => {
    expect(() => new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        throughputMode: lib_1.ThroughputMode.PROVISIONED,
        provisionedThroughputPerSecond: core_1.Size.kibibytes(10),
    })).toThrow(/cannot be converted into a whole number/);
});
test('fails when provisioned throughput is not a whole number of mebibytes', () => {
    expect(() => {
        new lib_1.FileSystem(stack, 'EfsFileSystem2', {
            vpc,
            throughputMode: lib_1.ThroughputMode.PROVISIONED,
            provisionedThroughputPerSecond: core_1.Size.kibibytes(2050),
        });
    }).toThrowError(/cannot be converted into a whole number/);
});
test('file system is created correctly with provisioned throughput mode', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
        throughputMode: lib_1.ThroughputMode.PROVISIONED,
        provisionedThroughputPerSecond: core_1.Size.mebibytes(5),
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        ThroughputMode: 'provisioned',
        ProvisionedThroughputInMibps: 5,
    }));
});
test('existing file system is imported correctly', () => {
    // WHEN
    const fs = lib_1.FileSystem.fromFileSystemAttributes(stack, 'existingFS', {
        fileSystemId: 'fs123',
        securityGroup: ec2.SecurityGroup.fromSecurityGroupId(stack, 'SG', 'sg-123456789', {
            allowAllOutbound: false,
        }),
    });
    fs.connections.allowToAnyIpv4(ec2.Port.tcp(443));
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EC2::SecurityGroupEgress', {
        GroupId: 'sg-123456789',
    }));
});
test('support tags', () => {
    // WHEN
    const fileSystem = new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
    });
    core_1.Tags.of(fileSystem).add('Name', 'LookAtMeAndMyFancyTags');
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        FileSystemTags: [
            { Key: 'Name', Value: 'LookAtMeAndMyFancyTags' },
        ],
    }));
});
test('file system is created correctly when given a name', () => {
    // WHEN
    new lib_1.FileSystem(stack, 'EfsFileSystem', {
        fileSystemName: 'MyNameableFileSystem',
        vpc,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        FileSystemTags: [
            { Key: 'Name', Value: 'MyNameableFileSystem' },
        ],
    }));
});
test('auto-named if none provided', () => {
    // WHEN
    const fileSystem = new lib_1.FileSystem(stack, 'EfsFileSystem', {
        vpc,
    });
    // THEN
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        FileSystemTags: [
            { Key: 'Name', Value: fileSystem.node.path },
        ],
    }));
});
test('removalPolicy is DESTROY', () => {
    new lib_1.FileSystem(stack, 'EfsFileSystem', { vpc, removalPolicy: core_1.RemovalPolicy.DESTROY });
    assert_1.expect(stack).to(assert_1.haveResource('AWS::EFS::FileSystem', {
        DeletionPolicy: 'Delete',
        UpdateReplacePolicy: 'Delete',
    }, assert_1.ResourcePart.CompleteDefinition));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWZzLWZpbGUtc3lzdGVtLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlZnMtZmlsZS1zeXN0ZW0udGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDRDQUFrRjtBQUNsRix3Q0FBd0M7QUFDeEMsd0NBQXdDO0FBQ3hDLHdDQUFpRTtBQUNqRSxnQ0FBc0Y7QUFFdEYsSUFBSSxLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztBQUN4QixJQUFJLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBRXBDLFVBQVUsQ0FBRSxHQUFHLEVBQUU7SUFDZixLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztJQUNwQixHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNsQyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUU7SUFDcEQsT0FBTztJQUNQLElBQUksZ0JBQVUsQ0FBQyxLQUFLLEVBQUUsZUFBZSxFQUFFO1FBQ3JDLEdBQUc7S0FDSixDQUFDLENBQUM7SUFDSCxPQUFPO0lBQ1AsZUFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxxQkFBWSxDQUFDLHNCQUFzQixFQUFFO1FBQ3ZELGNBQWMsRUFBRSxRQUFRO1FBQ3hCLG1CQUFtQixFQUFFLFFBQVE7S0FDOUIsRUFBRSxxQkFBWSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztJQUNyQyxlQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLHFCQUFZLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDO0lBQzNELGVBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMscUJBQVksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUM7QUFDL0QsQ0FBQyxDQUFDLENBQUM7QUFFSCxJ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SSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtJQUNwQyxJQUFJLGdCQUFVLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRSxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUUsb0JBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBRXRGLGVBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMscUJBQVksQ0FBQyxzQkFBc0IsRUFBRTtRQUN2RCxjQUFjLEVBQUUsUUFBUTtRQUN4QixtQkFBbUIsRUFBRSxRQUFRO0tBQzlCLEVBQUUscUJBQVksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7QUFFdkMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleHBlY3QgYXMgZXhwZWN0Q0RLLCBoYXZlUmVzb3VyY2UsIFJlc291cmNlUGFydCB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydCc7XG5pbXBvcnQgKiBhcyBlYzIgZnJvbSAnQGF3cy1jZGsvYXdzLWVjMic7XG5pbXBvcnQgKiBhcyBrbXMgZnJvbSAnQGF3cy1jZGsvYXdzLWttcyc7XG5pbXBvcnQgeyBSZW1vdmFsUG9saWN5LCBTaXplLCBTdGFjaywgVGFncyB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0IHsgRmlsZVN5c3RlbSwgTGlmZWN5Y2xlUG9saWN5LCBQZXJmb3JtYW5jZU1vZGUsIFRocm91Z2hwdXRNb2RlIH0gZnJvbSAnLi4vbGliJztcblxubGV0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG5sZXQgdnBjID0gbmV3IGVjMi5WcGMoc3RhY2ssICdWUEMnKTtcblxuYmVmb3JlRWFjaCggKCkgPT4ge1xuICBzdGFjayA9IG5ldyBTdGFjaygpO1xuICB2cGMgPSBuZXcgZWMyLlZwYyhzdGFjaywgJ1ZQQycpO1xufSk7XG5cbnRlc3QoJ2RlZmF1bHQgZmlsZSBzeXN0ZW0gaXMgY3JlYXRlZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IEZpbGVTeXN0ZW0oc3RhY2ssICdFZnNGaWxlU3lzdGVtJywge1xuICAgIHZwYyxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgZXhwZWN0Q0RLKHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6RUZTOjpGaWxlU3lzdGVtJywge1xuICAgIERlbGV0aW9uUG9saWN5OiAnUmV0YWluJyxcbiAgICBVcGRhdGVSZXBsYWNlUG9saWN5OiAnUmV0YWluJyxcbiAgfSwgUmVzb3VyY2VQYXJ0LkNvbXBsZXRlRGVmaW5pdGlvbikpO1xuICBleHBlY3RDREsoc3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnQVdTOjpFRlM6Ok1vdW50VGFyZ2V0JykpO1xuICBleHBlY3RDREsoc3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnQVdTOjpFQzI6OlNlY3VyaXR5R3JvdXAnKSk7XG59KTtcblxudGVzdCgndW5lbmNyeXB0ZWQgZmlsZSBzeXN0ZW0gaXMgY3JlYXRlZCBjb3JyZWN0bHkgd2l0aCBkZWZhdWx0IEtNUycsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICAgIGVuY3J5cHRlZDogZmFsc2UsXG4gIH0pO1xuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykubm90VG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBFbmNyeXB0ZWQ6IHRydWUsXG4gIH0pKTtcbn0pO1xuXG50ZXN0KCdlbmNyeXB0ZWQgZmlsZSBzeXN0ZW0gaXMgY3JlYXRlZCBjb3JyZWN0bHkgd2l0aCBkZWZhdWx0IEtNUycsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICAgIGVuY3J5cHRlZDogdHJ1ZSxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgZXhwZWN0Q0RLKHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6RUZTOjpGaWxlU3lzdGVtJywge1xuICAgIEVuY3J5cHRlZDogdHJ1ZSxcbiAgfSkpO1xufSk7XG5cbnRlc3QoJ2VuY3J5cHRlZCBmaWxlIHN5c3RlbSBpcyBjcmVhdGVkIGNvcnJlY3RseSB3aXRoIGN1c3RvbSBLTVMnLCAoKSA9PiB7XG4gIGNvbnN0IGtleSA9IG5ldyBrbXMuS2V5KHN0YWNrLCAnY3VzdG9tS2V5RlMnKTtcblxuICAvLyBXSEVOXG4gIG5ldyBGaWxlU3lzdGVtKHN0YWNrLCAnRWZzRmlsZVN5c3RlbScsIHtcbiAgICB2cGMsXG4gICAgZW5jcnlwdGVkOiB0cnVlLFxuICAgIGttc0tleToga2V5LFxuICB9KTtcbiAgLy8gVEhFTlxuXG4gIC8qXG4gICAqIENESyBhcHBlbmRzIDgtZGlnaXQgTUQ1IGhhc2ggb2YgdGhlIHJlc291cmNlIHBhdGggdG8gdGhlIGxvZ2ljYWwgSWQgb2YgdGhlIHJlc291cmNlIGluIG9yZGVyIHRvIG1ha2Ugc3VyZVxuICAgKiB0aGF0IHRoZSBpZCBpcyB1bmlxdWUgYWNyb3NzIG11bHRpcGxlIHN0YWNrcy4gVGhlcmUgaXNudCBhIGRpcmVjdCB3YXkgdG8gaWRlbnRpZnkgdGhlIGV4YWN0IG5hbWUgb2YgdGhlIHJlc291cmNlXG4gICAqIGluIGdlbmVyYXRlZCBDREssIGhlbmNlIGhhcmRjb2RpbmcgdGhlIE1ENSBoYXNoIGhlcmUgZm9yIGFzc2VydGlvbi4gQXNzdW1wdGlvbiBpcyB0aGF0IHRoZSBwYXRoIG9mIHRoZSBLZXkgd29udFxuICAgKiBjaGFuZ2UgaW4gdGhpcyBVVC4gQ2hlY2tlZCB0aGUgdW5pcXVlIGlkIGJ5IGdlbmVyYXRpbmcgdGhlIGNsb3VkIGZvcm1hdGlvbiBzdGFjay5cbiAgICovXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBFbmNyeXB0ZWQ6IHRydWUsXG4gICAgS21zS2V5SWQ6IHtcbiAgICAgIFJlZjogJ2N1c3RvbUtleUZTRERCODdDNkQnLFxuICAgIH0sXG4gIH0pKTtcbn0pO1xuXG50ZXN0KCdmaWxlIHN5c3RlbSBpcyBjcmVhdGVkIGNvcnJlY3RseSB3aXRoIGEgbGlmZSBjeWNsZSBwcm9wZXJ0eScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICAgIGxpZmVjeWNsZVBvbGljeTogTGlmZWN5Y2xlUG9saWN5LkFGVEVSXzdfREFZUyxcbiAgfSk7XG4gIC8vIFRIRU5cbiAgZXhwZWN0Q0RLKHN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ0FXUzo6RUZTOjpGaWxlU3lzdGVtJywge1xuICAgIExpZmVjeWNsZVBvbGljaWVzOiBbe1xuICAgICAgVHJhbnNpdGlvblRvSUE6ICdBRlRFUl83X0RBWVMnLFxuICAgIH1dLFxuICB9KSk7XG59KTtcblxudGVzdCgnZmlsZSBzeXN0ZW0gaXMgY3JlYXRlZCBjb3JyZWN0bHkgd2l0aCBwZXJmb3JtYW5jZSBtb2RlJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBGaWxlU3lzdGVtKHN0YWNrLCAnRWZzRmlsZVN5c3RlbScsIHtcbiAgICB2cGMsXG4gICAgcGVyZm9ybWFuY2VNb2RlOiBQZXJmb3JtYW5jZU1vZGUuTUFYX0lPLFxuICB9KTtcbiAgLy8gVEhFTlxuICBleHBlY3RDREsoc3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnQVdTOjpFRlM6OkZpbGVTeXN0ZW0nLCB7XG4gICAgUGVyZm9ybWFuY2VNb2RlOiAnbWF4SU8nLFxuICB9KSk7XG59KTtcblxudGVzdCgnZmlsZSBzeXN0ZW0gaXMgY3JlYXRlZCBjb3JyZWN0bHkgd2l0aCBidXJzdGluZyB0aHJvdWdocHV0IG1vZGUnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgbmV3IEZpbGVTeXN0ZW0oc3RhY2ssICdFZnNGaWxlU3lzdGVtJywge1xuICAgIHZwYyxcbiAgICB0aHJvdWdocHV0TW9kZTogVGhyb3VnaHB1dE1vZGUuQlVSU1RJTkcsXG4gIH0pO1xuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBUaHJvdWdocHV0TW9kZTogJ2J1cnN0aW5nJyxcbiAgfSkpO1xufSk7XG5cbnRlc3QoJ0V4Y2VwdGlvbiB3aGVuIHRocm91Z2hwdXQgbW9kZSBpcyBzZXQgdG8gUFJPVklTSU9ORUQsIGJ1dCBwcm92aXNpb25lZCB0aHJvdWdocHV0IGlzIG5vdCBzZXQnLCAoKSA9PiB7XG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IEZpbGVTeXN0ZW0oc3RhY2ssICdFZnNGaWxlU3lzdGVtJywge1xuICAgICAgdnBjLFxuICAgICAgdGhyb3VnaHB1dE1vZGU6IFRocm91Z2hwdXRNb2RlLlBST1ZJU0lPTkVELFxuICAgIH0pO1xuICB9KS50b1Rocm93RXJyb3IoL1Byb3BlcnR5IHByb3Zpc2lvbmVkVGhyb3VnaHB1dFBlclNlY29uZCBpcyByZXF1aXJlZCB3aGVuIHRocm91Z2hwdXRNb2RlIGlzIFBST1ZJU0lPTkVELyk7XG59KTtcblxudGVzdCgnZmFpbHMgd2hlbiBwcm92aXNpb25lZCB0aHJvdWdocHV0IGlzIGxlc3MgdGhhbiB0aGUgdmFsaWQgcmFuZ2UnLCAoKSA9PiB7XG4gIGV4cGVjdCgoKSA9PiBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICAgIHRocm91Z2hwdXRNb2RlOiBUaHJvdWdocHV0TW9kZS5QUk9WSVNJT05FRCxcbiAgICBwcm92aXNpb25lZFRocm91Z2hwdXRQZXJTZWNvbmQ6IFNpemUua2liaWJ5dGVzKDEwKSxcbiAgfSkpLnRvVGhyb3coL2Nhbm5vdCBiZSBjb252ZXJ0ZWQgaW50byBhIHdob2xlIG51bWJlci8pO1xufSk7XG5cbnRlc3QoJ2ZhaWxzIHdoZW4gcHJvdmlzaW9uZWQgdGhyb3VnaHB1dCBpcyBub3QgYSB3aG9sZSBudW1iZXIgb2YgbWViaWJ5dGVzJywgKCkgPT4ge1xuICBleHBlY3QoKCkgPT4ge1xuICAgIG5ldyBGaWxlU3lzdGVtKHN0YWNrLCAnRWZzRmlsZVN5c3RlbTInLCB7XG4gICAgICB2cGMsXG4gICAgICB0aHJvdWdocHV0TW9kZTogVGhyb3VnaHB1dE1vZGUuUFJPVklTSU9ORUQsXG4gICAgICBwcm92aXNpb25lZFRocm91Z2hwdXRQZXJTZWNvbmQ6IFNpemUua2liaWJ5dGVzKDIwNTApLFxuICAgIH0pO1xuICB9KS50b1Rocm93RXJyb3IoL2Nhbm5vdCBiZSBjb252ZXJ0ZWQgaW50byBhIHdob2xlIG51bWJlci8pO1xufSk7XG5cbnRlc3QoJ2ZpbGUgc3lzdGVtIGlzIGNyZWF0ZWQgY29ycmVjdGx5IHdpdGggcHJvdmlzaW9uZWQgdGhyb3VnaHB1dCBtb2RlJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIG5ldyBGaWxlU3lzdGVtKHN0YWNrLCAnRWZzRmlsZVN5c3RlbScsIHtcbiAgICB2cGMsXG4gICAgdGhyb3VnaHB1dE1vZGU6IFRocm91Z2hwdXRNb2RlLlBST1ZJU0lPTkVELFxuICAgIHByb3Zpc2lvbmVkVGhyb3VnaHB1dFBlclNlY29uZDogU2l6ZS5tZWJpYnl0ZXMoNSksXG4gIH0pO1xuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBUaHJvdWdocHV0TW9kZTogJ3Byb3Zpc2lvbmVkJyxcbiAgICBQcm92aXNpb25lZFRocm91Z2hwdXRJbk1pYnBzOiA1LFxuICB9KSk7XG59KTtcblxudGVzdCgnZXhpc3RpbmcgZmlsZSBzeXN0ZW0gaXMgaW1wb3J0ZWQgY29ycmVjdGx5JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGZzID0gRmlsZVN5c3RlbS5mcm9tRmlsZVN5c3RlbUF0dHJpYnV0ZXMoc3RhY2ssICdleGlzdGluZ0ZTJywge1xuICAgIGZpbGVTeXN0ZW1JZDogJ2ZzMTIzJyxcbiAgICBzZWN1cml0eUdyb3VwOiBlYzIuU2VjdXJpdHlHcm91cC5mcm9tU2VjdXJpdHlHcm91cElkKHN0YWNrLCAnU0cnLCAnc2ctMTIzNDU2Nzg5Jywge1xuICAgICAgYWxsb3dBbGxPdXRib3VuZDogZmFsc2UsXG4gICAgfSksXG4gIH0pO1xuXG4gIGZzLmNvbm5lY3Rpb25zLmFsbG93VG9BbnlJcHY0KGVjMi5Qb3J0LnRjcCg0NDMpKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVDMjo6U2VjdXJpdHlHcm91cEVncmVzcycsIHtcbiAgICBHcm91cElkOiAnc2ctMTIzNDU2Nzg5JyxcbiAgfSkpO1xufSk7XG5cbnRlc3QoJ3N1cHBvcnQgdGFncycsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBmaWxlU3lzdGVtID0gbmV3IEZpbGVTeXN0ZW0oc3RhY2ssICdFZnNGaWxlU3lzdGVtJywge1xuICAgIHZwYyxcbiAgfSk7XG4gIFRhZ3Mub2YoZmlsZVN5c3RlbSkuYWRkKCdOYW1lJywgJ0xvb2tBdE1lQW5kTXlGYW5jeVRhZ3MnKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBGaWxlU3lzdGVtVGFnczogW1xuICAgICAgeyBLZXk6ICdOYW1lJywgVmFsdWU6ICdMb29rQXRNZUFuZE15RmFuY3lUYWdzJyB9LFxuICAgIF0sXG4gIH0pKTtcbn0pO1xuXG50ZXN0KCdmaWxlIHN5c3RlbSBpcyBjcmVhdGVkIGNvcnJlY3RseSB3aGVuIGdpdmVuIGEgbmFtZScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgZmlsZVN5c3RlbU5hbWU6ICdNeU5hbWVhYmxlRmlsZVN5c3RlbScsXG4gICAgdnBjLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBGaWxlU3lzdGVtVGFnczogW1xuICAgICAgeyBLZXk6ICdOYW1lJywgVmFsdWU6ICdNeU5hbWVhYmxlRmlsZVN5c3RlbScgfSxcbiAgICBdLFxuICB9KSk7XG59KTtcblxudGVzdCgnYXV0by1uYW1lZCBpZiBub25lIHByb3ZpZGVkJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGZpbGVTeXN0ZW0gPSBuZXcgRmlsZVN5c3RlbShzdGFjaywgJ0Vmc0ZpbGVTeXN0ZW0nLCB7XG4gICAgdnBjLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdENESyhzdGFjaykudG8oaGF2ZVJlc291cmNlKCdBV1M6OkVGUzo6RmlsZVN5c3RlbScsIHtcbiAgICBGaWxlU3lzdGVtVGFnczogW1xuICAgICAgeyBLZXk6ICdOYW1lJywgVmFsdWU6IGZpbGVTeXN0ZW0ubm9kZS5wYXRoIH0sXG4gICAgXSxcbiAgfSkpO1xufSk7XG5cbnRlc3QoJ3JlbW92YWxQb2xpY3kgaXMgREVTVFJPWScsICgpID0+IHtcbiAgbmV3IEZpbGVTeXN0ZW0oc3RhY2ssICdFZnNGaWxlU3lzdGVtJywgeyB2cGMsIHJlbW92YWxQb2xpY3k6IFJlbW92YWxQb2xpY3kuREVTVFJPWSB9KTtcblxuICBleHBlY3RDREsoc3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnQVdTOjpFRlM6OkZpbGVTeXN0ZW0nLCB7XG4gICAgRGVsZXRpb25Qb2xpY3k6ICdEZWxldGUnLFxuICAgIFVwZGF0ZVJlcGxhY2VQb2xpY3k6ICdEZWxldGUnLFxuICB9LCBSZXNvdXJjZVBhcnQuQ29tcGxldGVEZWZpbml0aW9uKSk7XG5cbn0pO1xuIl19