"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cloudAssemblyBuildSpecDir = exports.embeddedAsmPath = exports.assemblyBuilderOf = exports.appOf = void 0;
/**
 * Get access to construct internals that we need but got removed from the Stages PR.
 */
const path = require("path");
const core_1 = require("@aws-cdk/core");
function appOf(construct) {
    const root = construct.node.root;
    if (!core_1.App.isApp(root)) {
        throw new Error(`Construct must be created under an App, but is not: ${construct.node.path}`);
    }
    return root;
}
exports.appOf = appOf;
function assemblyBuilderOf(stage) {
    return stage._assemblyBuilder;
}
exports.assemblyBuilderOf = assemblyBuilderOf;
/**
 * Return the relative path from the app assembly to the scope's (nested) assembly
 */
function embeddedAsmPath(scope) {
    var _a;
    const appAsmRoot = assemblyBuilderOf(appOf(scope)).outdir;
    const stage = (_a = core_1.Stage.of(scope)) !== null && _a !== void 0 ? _a : appOf(scope);
    const stageAsmRoot = assemblyBuilderOf(stage).outdir;
    return path.relative(appAsmRoot, stageAsmRoot) || '.';
}
exports.embeddedAsmPath = embeddedAsmPath;
/**
 * Determine the directory where the cloud assembly will be written, for use in a BuildSpec
 */
function cloudAssemblyBuildSpecDir(scope) {
    return assemblyBuilderOf(appOf(scope)).outdir;
}
exports.cloudAssemblyBuildSpecDir = cloudAssemblyBuildSpecDir;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RydWN0LWludGVybmFscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvbnN0cnVjdC1pbnRlcm5hbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUE7O0dBRUc7QUFDSCw2QkFBNkI7QUFDN0Isd0NBQXVEO0FBR3ZELFNBQWdCLEtBQUssQ0FBQyxTQUFxQjtJQUN6QyxNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztJQUVqQyxJQUFJLENBQUMsVUFBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNwQixNQUFNLElBQUksS0FBSyxDQUFDLHVEQUF1RCxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7S0FDL0Y7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFSRCxzQkFRQztBQUVELFNBQWdCLGlCQUFpQixDQUFDLEtBQVk7SUFDNUMsT0FBUSxLQUFhLENBQUMsZ0JBQWdCLENBQUM7QUFDekMsQ0FBQztBQUZELDhDQUVDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixlQUFlLENBQUMsS0FBaUI7O0lBQy9DLE1BQU0sVUFBVSxHQUFHLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUMxRCxNQUFNLEtBQUssU0FBRyxZQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxtQ0FBSSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDOUMsTUFBTSxZQUFZLEdBQUcsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQ3JELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLElBQUksR0FBRyxDQUFDO0FBQ3hELENBQUM7QUFMRCwwQ0FLQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IseUJBQXlCLENBQUMsS0FBaUI7SUFDekQsT0FBTyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7QUFDaEQsQ0FBQztBQUZELDhEQUVDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBHZXQgYWNjZXNzIHRvIGNvbnN0cnVjdCBpbnRlcm5hbHMgdGhhdCB3ZSBuZWVkIGJ1dCBnb3QgcmVtb3ZlZCBmcm9tIHRoZSBTdGFnZXMgUFIuXG4gKi9cbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBBcHAsIElDb25zdHJ1Y3QsIFN0YWdlIH0gZnJvbSAnQGF3cy1jZGsvY29yZSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuXG5leHBvcnQgZnVuY3Rpb24gYXBwT2YoY29uc3RydWN0OiBJQ29uc3RydWN0KTogQXBwIHtcbiAgY29uc3Qgcm9vdCA9IGNvbnN0cnVjdC5ub2RlLnJvb3Q7XG5cbiAgaWYgKCFBcHAuaXNBcHAocm9vdCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvbnN0cnVjdCBtdXN0IGJlIGNyZWF0ZWQgdW5kZXIgYW4gQXBwLCBidXQgaXMgbm90OiAke2NvbnN0cnVjdC5ub2RlLnBhdGh9YCk7XG4gIH1cblxuICByZXR1cm4gcm9vdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VtYmx5QnVpbGRlck9mKHN0YWdlOiBTdGFnZSk6IGN4YXBpLkNsb3VkQXNzZW1ibHlCdWlsZGVyIHtcbiAgcmV0dXJuIChzdGFnZSBhcyBhbnkpLl9hc3NlbWJseUJ1aWxkZXI7XG59XG5cbi8qKlxuICogUmV0dXJuIHRoZSByZWxhdGl2ZSBwYXRoIGZyb20gdGhlIGFwcCBhc3NlbWJseSB0byB0aGUgc2NvcGUncyAobmVzdGVkKSBhc3NlbWJseVxuICovXG5leHBvcnQgZnVuY3Rpb24gZW1iZWRkZWRBc21QYXRoKHNjb3BlOiBJQ29uc3RydWN0KSB7XG4gIGNvbnN0IGFwcEFzbVJvb3QgPSBhc3NlbWJseUJ1aWxkZXJPZihhcHBPZihzY29wZSkpLm91dGRpcjtcbiAgY29uc3Qgc3RhZ2UgPSBTdGFnZS5vZihzY29wZSkgPz8gYXBwT2Yoc2NvcGUpO1xuICBjb25zdCBzdGFnZUFzbVJvb3QgPSBhc3NlbWJseUJ1aWxkZXJPZihzdGFnZSkub3V0ZGlyO1xuICByZXR1cm4gcGF0aC5yZWxhdGl2ZShhcHBBc21Sb290LCBzdGFnZUFzbVJvb3QpIHx8ICcuJztcbn1cblxuLyoqXG4gKiBEZXRlcm1pbmUgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgY2xvdWQgYXNzZW1ibHkgd2lsbCBiZSB3cml0dGVuLCBmb3IgdXNlIGluIGEgQnVpbGRTcGVjXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbG91ZEFzc2VtYmx5QnVpbGRTcGVjRGlyKHNjb3BlOiBJQ29uc3RydWN0KSB7XG4gIHJldHVybiBhc3NlbWJseUJ1aWxkZXJPZihhcHBPZihzY29wZSkpLm91dGRpcjtcbn0iXX0=