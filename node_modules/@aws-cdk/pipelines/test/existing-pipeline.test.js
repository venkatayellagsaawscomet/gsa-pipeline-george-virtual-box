"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assert_1 = require("@aws-cdk/assert");
require("@aws-cdk/assert/jest");
const cp = require("@aws-cdk/aws-codepipeline");
const core_1 = require("@aws-cdk/core");
const cdkp = require("../lib");
const testutil_1 = require("./testutil");
let app;
let pipelineStack;
let sourceArtifact;
let cloudAssemblyArtifact;
let codePipeline;
beforeEach(() => {
    app = new testutil_1.TestApp();
    pipelineStack = new core_1.Stack(app, 'PipelineStack', { env: testutil_1.PIPELINE_ENV });
    sourceArtifact = new cp.Artifact();
    cloudAssemblyArtifact = new cp.Artifact();
});
afterEach(() => {
    app.cleanup();
});
describe('with empty existing CodePipeline', () => {
    beforeEach(() => {
        codePipeline = new cp.Pipeline(pipelineStack, 'CodePipeline');
    });
    test('both actions are required', () => {
        // WHEN
        expect(() => {
            new cdkp.CdkPipeline(pipelineStack, 'Cdk', { cloudAssemblyArtifact, codePipeline });
        }).toThrow(/You must pass a 'sourceAction'/);
    });
    test('can give both actions', () => {
        // WHEN
        new cdkp.CdkPipeline(pipelineStack, 'Cdk', {
            cloudAssemblyArtifact,
            codePipeline,
            sourceAction: new testutil_1.TestGitHubAction(sourceArtifact),
            synthAction: cdkp.SimpleSynthAction.standardNpmSynth({ sourceArtifact, cloudAssemblyArtifact }),
        });
        // THEN
        expect(pipelineStack).toHaveResourceLike('AWS::CodePipeline::Pipeline', {
            Stages: [
                assert_1.objectLike({ Name: 'Source' }),
                assert_1.objectLike({ Name: 'Build' }),
                assert_1.objectLike({ Name: 'UpdatePipeline' }),
            ],
        });
    });
});
describe('with custom Source stage in existing Pipeline', () => {
    beforeEach(() => {
        codePipeline = new cp.Pipeline(pipelineStack, 'CodePipeline', {
            stages: [
                {
                    stageName: 'CustomSource',
                    actions: [new testutil_1.TestGitHubAction(sourceArtifact)],
                },
            ],
        });
    });
    test('synth action is required', () => {
        // WHEN
        expect(() => {
            new cdkp.CdkPipeline(pipelineStack, 'Cdk', { cloudAssemblyArtifact, codePipeline });
        }).toThrow(/You must pass a 'synthAction'/);
    });
    test('Work with synthAction', () => {
        // WHEN
        new cdkp.CdkPipeline(pipelineStack, 'Cdk', {
            codePipeline,
            cloudAssemblyArtifact,
            synthAction: cdkp.SimpleSynthAction.standardNpmSynth({ sourceArtifact, cloudAssemblyArtifact }),
        });
        // THEN
        expect(pipelineStack).toHaveResourceLike('AWS::CodePipeline::Pipeline', {
            Stages: [
                assert_1.objectLike({ Name: 'CustomSource' }),
                assert_1.objectLike({ Name: 'Build' }),
                assert_1.objectLike({ Name: 'UpdatePipeline' }),
            ],
        });
    });
});
describe('with Source and Build stages in existing Pipeline', () => {
    beforeEach(() => {
        codePipeline = new cp.Pipeline(pipelineStack, 'CodePipeline', {
            stages: [
                {
                    stageName: 'CustomSource',
                    actions: [new testutil_1.TestGitHubAction(sourceArtifact)],
                },
                {
                    stageName: 'CustomBuild',
                    actions: [cdkp.SimpleSynthAction.standardNpmSynth({ sourceArtifact, cloudAssemblyArtifact })],
                },
            ],
        });
    });
    test('can supply no actions', () => {
        // WHEN
        new cdkp.CdkPipeline(pipelineStack, 'Cdk', {
            codePipeline,
            cloudAssemblyArtifact,
        });
        // THEN
        expect(pipelineStack).toHaveResourceLike('AWS::CodePipeline::Pipeline', {
            Stages: [
                assert_1.objectLike({ Name: 'CustomSource' }),
                assert_1.objectLike({ Name: 'CustomBuild' }),
                assert_1.objectLike({ Name: 'UpdatePipeline' }),
            ],
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhpc3RpbmctcGlwZWxpbmUudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV4aXN0aW5nLXBpcGVsaW5lLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBNkM7QUFDN0MsZ0NBQThCO0FBQzlCLGdEQUFnRDtBQUNoRCx3Q0FBc0M7QUFDdEMsK0JBQStCO0FBQy9CLHlDQUFxRTtBQUVyRSxJQUFJLEdBQVksQ0FBQztBQUNqQixJQUFJLGFBQW9CLENBQUM7QUFDekIsSUFBSSxjQUEyQixDQUFDO0FBQ2hDLElBQUkscUJBQWtDLENBQUM7QUFDdkMsSUFBSSxZQUF5QixDQUFDO0FBRTlCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7SUFDZCxHQUFHLEdBQUcsSUFBSSxrQkFBTyxFQUFFLENBQUM7SUFDcEIsYUFBYSxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxlQUFlLEVBQUUsRUFBRSxHQUFHLEVBQUUsdUJBQVksRUFBRSxDQUFDLENBQUM7SUFDdkUsY0FBYyxHQUFHLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ25DLHFCQUFxQixHQUFHLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQzVDLENBQUMsQ0FBQyxDQUFDO0FBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtJQUNiLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNoQixDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7SUFDaEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFlBQVksR0FBRyxJQUFJLEVBQUUsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUNyQyxPQUFPO1FBQ1AsTUFBTSxDQUFDLEdBQUcsRUFBRTtZQUNWLElBQUksSUFBSSxDQUFDLFdB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LEVBQUU7WUFDNUQsTUFBTSxFQUFFO2dCQUNOO29CQUNFLFNBQVMsRUFBRSxjQUFjO29CQUN6QixPQUFPLEVBQUUsQ0FBQyxJQUFJLDJCQUFnQixDQUFDLGNBQWMsQ0FBQyxDQUFDO2lCQUNoRDtnQkFDRDtvQkFDRSxTQUFTLEVBQUUsYUFBYTtvQkFDeEIsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLEVBQUUsY0FBYyxFQUFFLHFCQUFxQixFQUFFLENBQUMsQ0FBQztpQkFDOUY7YUFDRjtTQUNGLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtRQUNqQyxPQUFPO1FBQ1AsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxLQUFLLEVBQUU7WUFDekMsWUFBWTtZQUNaLHFCQUFxQjtTQUN0QixDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLDZCQUE2QixFQUFFO1lBQ3RFLE1BQU0sRUFBRTtnQkFDTixtQkFBVSxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxDQUFDO2dCQUNwQyxtQkFBVSxDQUFDLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDO2dCQUNuQyxtQkFBVSxDQUFDLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLENBQUM7YUFDdkM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgb2JqZWN0TGlrZSB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydCc7XG5pbXBvcnQgJ0Bhd3MtY2RrL2Fzc2VydC9qZXN0JztcbmltcG9ydCAqIGFzIGNwIGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUnO1xuaW1wb3J0IHsgU3RhY2sgfSBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCAqIGFzIGNka3AgZnJvbSAnLi4vbGliJztcbmltcG9ydCB7IFBJUEVMSU5FX0VOViwgVGVzdEFwcCwgVGVzdEdpdEh1YkFjdGlvbiB9IGZyb20gJy4vdGVzdHV0aWwnO1xuXG5sZXQgYXBwOiBUZXN0QXBwO1xubGV0IHBpcGVsaW5lU3RhY2s6IFN0YWNrO1xubGV0IHNvdXJjZUFydGlmYWN0OiBjcC5BcnRpZmFjdDtcbmxldCBjbG91ZEFzc2VtYmx5QXJ0aWZhY3Q6IGNwLkFydGlmYWN0O1xubGV0IGNvZGVQaXBlbGluZTogY3AuUGlwZWxpbmU7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBhcHAgPSBuZXcgVGVzdEFwcCgpO1xuICBwaXBlbGluZVN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1BpcGVsaW5lU3RhY2snLCB7IGVudjogUElQRUxJTkVfRU5WIH0pO1xuICBzb3VyY2VBcnRpZmFjdCA9IG5ldyBjcC5BcnRpZmFjdCgpO1xuICBjbG91ZEFzc2VtYmx5QXJ0aWZhY3QgPSBuZXcgY3AuQXJ0aWZhY3QoKTtcbn0pO1xuXG5hZnRlckVhY2goKCkgPT4ge1xuICBhcHAuY2xlYW51cCgpO1xufSk7XG5cbmRlc2NyaWJlKCd3aXRoIGVtcHR5IGV4aXN0aW5nIENvZGVQaXBlbGluZScsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY29kZVBpcGVsaW5lID0gbmV3IGNwLlBpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDb2RlUGlwZWxpbmUnKTtcbiAgfSk7XG5cbiAgdGVzdCgnYm90aCBhY3Rpb25zIGFyZSByZXF1aXJlZCcsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIG5ldyBjZGtwLkNka1BpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7IGNsb3VkQXNzZW1ibHlBcnRpZmFjdCwgY29kZVBpcGVsaW5lIH0pO1xuICAgIH0pLnRvVGhyb3coL1lvdSBtdXN0IHBhc3MgYSAnc291cmNlQWN0aW9uJy8pO1xuICB9KTtcblxuICB0ZXN0KCdjYW4gZ2l2ZSBib3RoIGFjdGlvbnMnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIG5ldyBjZGtwLkNka1BpcGVsaW5lKHBpcGVsaW5lU3RhY2ssICdDZGsnLCB7XG4gICAgICBjbG91ZEFzc2VtYmx5QXJ0aWZhY3QsXG4gICAgICBjb2RlUGlwZWxpbmUsXG4gICAgICBzb3VyY2VBY3Rpb246IG5ldyBUZXN0R2l0SHViQWN0aW9uKHNvdXJjZUFydGlmYWN0KSxcbiAgICAgIHN5bnRoQWN0aW9uOiBjZGtwLlNpbXBsZVN5bnRoQWN0aW9uLnN0YW5kYXJkTnBtU3ludGgoeyBzb3VyY2VBcnRpZmFjdCwgY2xvdWRBc3NlbWJseUFydGlmYWN0IH0pLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIGV4cGVjdChwaXBlbGluZVN0YWNrKS50b0hhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZVBpcGVsaW5lOjpQaXBlbGluZScsIHtcbiAgICAgIFN0YWdlczogW1xuICAgICAgICBvYmplY3RMaWtlKHsgTmFtZTogJ1NvdXJjZScgfSksXG4gICAgICAgIG9iamVjdExpa2UoeyBOYW1lOiAnQnVpbGQnIH0pLFxuICAgICAgICBvYmplY3RMaWtlKHsgTmFtZTogJ1VwZGF0ZVBpcGVsaW5lJyB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCd3aXRoIGN1c3RvbSBTb3VyY2Ugc3RhZ2UgaW4gZXhpc3RpbmcgUGlwZWxpbmUnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGNvZGVQaXBlbGluZSA9IG5ldyBjcC5QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ29kZVBpcGVsaW5lJywge1xuICAgICAgc3RhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBzdGFnZU5hbWU6ICdDdXN0b21Tb3VyY2UnLFxuICAgICAgICAgIGFjdGlvbnM6IFtuZXcgVGVzdEdpdEh1YkFjdGlvbihzb3VyY2VBcnRpZmFjdCldLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnc3ludGggYWN0aW9uIGlzIHJlcXVpcmVkJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgbmV3IGNka3AuQ2RrUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycsIHsgY2xvdWRBc3NlbWJseUFydGlmYWN0LCBjb2RlUGlwZWxpbmUgfSk7XG4gICAgfSkudG9UaHJvdygvWW91IG11c3QgcGFzcyBhICdzeW50aEFjdGlvbicvKTtcbiAgfSk7XG5cbiAgdGVzdCgnV29yayB3aXRoIHN5bnRoQWN0aW9uJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBuZXcgY2RrcC5DZGtQaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ2RrJywge1xuICAgICAgY29kZVBpcGVsaW5lLFxuICAgICAgY2xvdWRBc3NlbWJseUFydGlmYWN0LFxuICAgICAgc3ludGhBY3Rpb246IGNka3AuU2ltcGxlU3ludGhBY3Rpb24uc3RhbmRhcmROcG1TeW50aCh7IHNvdXJjZUFydGlmYWN0LCBjbG91ZEFzc2VtYmx5QXJ0aWZhY3QgfSksXG4gICAgfSk7XG5cbiAgICAvLyBUSEVOXG4gICAgZXhwZWN0KHBpcGVsaW5lU3RhY2spLnRvSGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlUGlwZWxpbmU6OlBpcGVsaW5lJywge1xuICAgICAgU3RhZ2VzOiBbXG4gICAgICAgIG9iamVjdExpa2UoeyBOYW1lOiAnQ3VzdG9tU291cmNlJyB9KSxcbiAgICAgICAgb2JqZWN0TGlrZSh7IE5hbWU6ICdCdWlsZCcgfSksXG4gICAgICAgIG9iamVjdExpa2UoeyBOYW1lOiAnVXBkYXRlUGlwZWxpbmUnIH0pLFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3dpdGggU291cmNlIGFuZCBCdWlsZCBzdGFnZXMgaW4gZXhpc3RpbmcgUGlwZWxpbmUnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGNvZGVQaXBlbGluZSA9IG5ldyBjcC5QaXBlbGluZShwaXBlbGluZVN0YWNrLCAnQ29kZVBpcGVsaW5lJywge1xuICAgICAgc3RhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBzdGFnZU5hbWU6ICdDdXN0b21Tb3VyY2UnLFxuICAgICAgICAgIGFjdGlvbnM6IFtuZXcgVGVzdEdpdEh1YkFjdGlvbihzb3VyY2VBcnRpZmFjdCldLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgc3RhZ2VOYW1lOiAnQ3VzdG9tQnVpbGQnLFxuICAgICAgICAgIGFjdGlvbnM6IFtjZGtwLlNpbXBsZVN5bnRoQWN0aW9uLnN0YW5kYXJkTnBtU3ludGgoeyBzb3VyY2VBcnRpZmFjdCwgY2xvdWRBc3NlbWJseUFydGlmYWN0IH0pXSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2NhbiBzdXBwbHkgbm8gYWN0aW9ucycsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgbmV3IGNka3AuQ2RrUGlwZWxpbmUocGlwZWxpbmVTdGFjaywgJ0NkaycsIHtcbiAgICAgIGNvZGVQaXBlbGluZSxcbiAgICAgIGNsb3VkQXNzZW1ibHlBcnRpZmFjdCxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QocGlwZWxpbmVTdGFjaykudG9IYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVQaXBlbGluZTo6UGlwZWxpbmUnLCB7XG4gICAgICBTdGFnZXM6IFtcbiAgICAgICAgb2JqZWN0TGlrZSh7IE5hbWU6ICdDdXN0b21Tb3VyY2UnIH0pLFxuICAgICAgICBvYmplY3RMaWtlKHsgTmFtZTogJ0N1c3RvbUJ1aWxkJyB9KSxcbiAgICAgICAgb2JqZWN0TGlrZSh7IE5hbWU6ICdVcGRhdGVQaXBlbGluZScgfSksXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==