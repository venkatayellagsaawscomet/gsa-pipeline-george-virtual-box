"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const AWS = require("aws-sdk-mock");
const fs = require("fs-extra");
const nock = require("nock");
const sinon = require("sinon");
const lib_1 = require("../../lib");
const runtime_1 = require("../../lib/aws-custom-resource/runtime");
// This test performs an 'npm install' which may take longer than the default
// 5s timeout
jest.setTimeout(60000);
/* eslint-disable no-console */
console.log = jest.fn();
const eventCommon = {
    ServiceToken: 'token',
    ResponseURL: 'https://localhost',
    StackId: 'stackId',
    RequestId: 'requestId',
    LogicalResourceId: 'logicalResourceId',
    ResourceType: 'Custom::AWS',
};
function createRequest(bodyPredicate) {
    return nock('https://localhost')
        .put('/', bodyPredicate)
        .reply(200);
}
beforeEach(() => {
    AWS.setSDK(require.resolve('aws-sdk'));
});
afterEach(() => {
    AWS.restore();
    nock.cleanAll();
});
test('create event with physical resource id path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'second-key-etag' &&
        body.Data['Contents.0.Key'] === 'first-key');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(listObjectsFake, {
        Bucket: 'my-bucket',
    });
    expect(request.isDone()).toBeTruthy();
});
test('update event with physical resource id', async () => {
    const publish = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publish);
    const event = {
        ...eventCommon,
        RequestType: 'Update',
        PhysicalResourceId: 'physicalResourceId',
        OldResourceProperties: {},
        ResourceProperties: {
            ServiceToken: 'token',
            Update: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'hello',
                    TopicArn: 'topicarn',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('topicarn'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'topicarn');
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('delete event', async () => {
    const listObjectsFake = sinon.fake.resolves({});
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.fromResponse('Contents.1.ETag'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await runtime_1.handler(event, {});
    sinon.assert.notCalled(listObjectsFake);
    expect(request.isDone()).toBeTruthy();
});
test('delete event with Delete call and no physical resource id in call', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Delete',
        PhysicalResourceId: 'physicalResourceId',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: {
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(deleteParameterFake, {
        Name: 'my-param',
    });
    expect(request.isDone()).toBeTruthy();
});
test('create event with Delete call only', async () => {
    const deleteParameterFake = sinon.fake.resolves({});
    AWS.mock('SSM', 'deleteParameter', deleteParameterFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Delete: {
                service: 'SSM',
                action: 'deleteParameter',
                parameters: {
                    Name: 'my-param',
                },
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'logicalResourceId');
    await runtime_1.handler(event, {});
    sinon.assert.notCalled(deleteParameterFake);
    expect(request.isDone()).toBeTruthy();
});
test('catch errors', async () => {
    const error = new Error();
    error.code = 'NoSuchBucket';
    const listObjectsFake = sinon.fake.rejects(error);
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('physicalResourceId'),
                ignoreErrorCodesMatching: 'NoSuchBucket',
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'physicalResourceId' &&
        Object.keys(body.Data).length === 0);
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('decodes booleans', async () => {
    const putItemFake = sinon.fake.resolves({});
    AWS.mock('DynamoDB', 'putItem', putItemFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'DynamoDB',
                action: 'putItem',
                parameters: {
                    TableName: 'table',
                    Item: {
                        True: {
                            BOOL: 'TRUE:BOOLEAN',
                        },
                        TrueString: {
                            S: 'true',
                        },
                        False: {
                            BOOL: 'FALSE:BOOLEAN',
                        },
                        FalseString: {
                            S: 'false',
                        },
                    },
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('put-item'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS');
    await runtime_1.handler(event, {});
    sinon.assert.calledWith(putItemFake, {
        TableName: 'table',
        Item: {
            True: {
                BOOL: true,
            },
            TrueString: {
                S: 'true',
            },
            False: {
                BOOL: false,
            },
            FalseString: {
                S: 'false',
            },
        },
    });
    expect(request.isDone()).toBeTruthy();
});
test('restrict output path', async () => {
    const listObjectsFake = sinon.fake.resolves({
        Contents: [
            {
                Key: 'first-key',
                ETag: 'first-key-etag',
            },
            {
                Key: 'second-key',
                ETag: 'second-key-etag',
            },
        ],
    });
    AWS.mock('S3', 'listObjects', listObjectsFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'S3',
                action: 'listObjects',
                parameters: {
                    Bucket: 'my-bucket',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
                outputPath: 'Contents.0',
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.PhysicalResourceId === 'id' &&
        body.Data['Contents.0.Key'] === 'first-key' &&
        body.Data['Contents.1.Key'] === undefined);
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('can specify apiVersion and region', async () => {
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                apiVersion: '2010-03-31',
                region: 'eu-west-1',
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            },
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS' &&
        body.Data.apiVersion === '2010-03-31' &&
        body.Data.region === 'eu-west-1');
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
});
test('flatten correctly flattens a nested object', () => {
    expect(runtime_1.flatten({
        a: { b: 'c' },
        d: [
            { e: 'f' },
            { g: 'h', i: 1, j: null, k: { l: false } },
        ],
    })).toEqual({
        'a.b': 'c',
        'd.0.e': 'f',
        'd.1.g': 'h',
        'd.1.i': 1,
        'd.1.j': null,
        'd.1.k.l': false,
    });
});
test('flatten correctly flattens an object with buffers', () => {
    expect(runtime_1.flatten({
        body: Buffer.from('body'),
        nested: {
            buffer: Buffer.from('buffer'),
            array: [
                Buffer.from('array.0'),
                Buffer.from('array.1'),
            ],
        },
    })).toEqual({
        'body': 'body',
        'nested.buffer': 'buffer',
        'nested.array.0': 'array.0',
        'nested.array.1': 'array.1',
    });
});
test('installs the latest SDK', async () => {
    const tmpPath = '/tmp/node_modules/aws-sdk';
    // Symlink to normal SDK to be able to call AWS.setSDK()
    await fs.ensureDir('/tmp/node_modules');
    await fs.symlink(require.resolve('aws-sdk'), tmpPath);
    AWS.setSDK(tmpPath);
    // Now remove the symlink and let the handler install it
    await fs.unlink(tmpPath);
    const publishFake = sinon.fake.resolves({});
    AWS.mock('SNS', 'publish', publishFake);
    const event = {
        ...eventCommon,
        RequestType: 'Create',
        ResourceProperties: {
            ServiceToken: 'token',
            Create: {
                service: 'SNS',
                action: 'publish',
                parameters: {
                    Message: 'message',
                    TopicArn: 'topic',
                },
                physicalResourceId: lib_1.PhysicalResourceId.of('id'),
            },
            InstallLatestAwsSdk: 'true',
        },
    };
    const request = createRequest(body => body.Status === 'SUCCESS');
    // Reset to 'false' so that the next run will reinstall aws-sdk
    runtime_1.forceSdkInstallation();
    await runtime_1.handler(event, {});
    expect(request.isDone()).toBeTruthy();
    expect(() => require.resolve(tmpPath)).not.toThrow();
    // clean up aws-sdk install
    await fs.remove(tmpPath);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXdzLWN1c3RvbS1yZXNvdXJjZS1wcm92aWRlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esb0NBQW9DO0FBQ3BDLCtCQUErQjtBQUMvQiw2QkFBNkI7QUFDN0IsK0JBQStCO0FBQy9CLG1DQUEyRDtBQUMzRCxtRUFBK0Y7QUFHL0YsNkVBQTZFO0FBQzdFLGFBQWE7QUFDYixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQU0sQ0FBQyxDQUFDO0FBRXhCLCtCQUErQjtBQUUvQixPQUFPLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUV4QixNQUFNLFdBQVcsR0FBRztJQUNsQixZQUFZLEVBQUUsT0FBTztJQUNyQixXQUFXLEVBQUUsbUJBQW1CO0lBQ2hDLE9BQU8sRUFBRSxTQUFTO0lBQ2xCLFNBQVMsRUFBRSxXQUFXO0lBQ3RCLGlCQUFpQixFQUFFLG1CQUFtQjtJQUN0QyxZQUFZLEVBQUUsYUFBYTtDQUM1QixDQUFDO0FBRUYsU0FBUyxhQUFhLENBQUMsYUFBZ0Y7SUFDckcsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUM7U0FDN0IsR0FBRyxDQUFDLEdBQUcsRUFBRSxhQUFhLENBQUM7U0FDdkIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2hCLENBQUM7QUFFRCxVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDekMsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFTLENBQUMsR0FBRyxFQUFFO0lBQ2IsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2QsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ2xCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLDZDQUE2QyxFQUFF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QUFFLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUV4QyxNQUFNLEtBQUssR0FBc0Q7UUFDL0QsR0FBRyxXQUFXO1FBQ2QsV0FBVyxFQUFFLFFBQVE7UUFDckIsa0JBQWtCLEVBQUU7WUFDbEIsWUFBWSxFQUFFLE9BQU87WUFDckIsTUFBTSxFQUFFO2dCQUNOLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE1BQU0sRUFBRSxTQUFTO2dCQUNqQixVQUFVLEVBQUU7b0JBQ1YsT0FBTyxFQUFFLFNBQVM7b0JBQ2xCLFFBQVEsRUFBRSxPQUFPO2lCQUNsQjtnQkFDRCxrQkFBa0IsRUFBRSx3QkFBa0IsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDO2FBQ2xDO1lBQ2YsbUJBQW1CLEVBQUUsTUFBTTtTQUM1QjtLQUNGLENBQUM7SUFFRixNQUFNLE9BQU8sR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDbkMsSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLENBQzFCLENBQUM7SUFFRiwrREFBK0Q7SUFDL0QsOEJBQW9CLEVBQUUsQ0FBQztJQUN2QixNQUFNLGlCQUFPLENBQUMsS0FBSyxFQUFFLEVBQXVCLENBQUMsQ0FBQztJQUU5QyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7SUFFdEMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7SUFFckQsMkJBQTJCO0lBQzNCLE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMzQixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFNESyBmcm9tICdhd3Mtc2RrJztcbmltcG9ydCAqIGFzIEFXUyBmcm9tICdhd3Mtc2RrLW1vY2snO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0ICogYXMgbm9jayBmcm9tICdub2NrJztcbmltcG9ydCAqIGFzIHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7IEF3c1Nka0NhbGwsIFBoeXNpY2FsUmVzb3VyY2VJZCB9IGZyb20gJy4uLy4uL2xpYic7XG5pbXBvcnQgeyBmbGF0dGVuLCBoYW5kbGVyLCBmb3JjZVNka0luc3RhbGxhdGlvbiB9IGZyb20gJy4uLy4uL2xpYi9hd3MtY3VzdG9tLXJlc291cmNlL3J1bnRpbWUnO1xuXG5cbi8vIFRoaXMgdGVzdCBwZXJmb3JtcyBhbiAnbnBtIGluc3RhbGwnIHdoaWNoIG1heSB0YWtlIGxvbmdlciB0aGFuIHRoZSBkZWZhdWx0XG4vLyA1cyB0aW1lb3V0XG5qZXN0LnNldFRpbWVvdXQoNjBfMDAwKTtcblxuLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqL1xuXG5jb25zb2xlLmxvZyA9IGplc3QuZm4oKTtcblxuY29uc3QgZXZlbnRDb21tb24gPSB7XG4gIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgUmVzcG9uc2VVUkw6ICdodHRwczovL2xvY2FsaG9zdCcsXG4gIFN0YWNrSWQ6ICdzdGFja0lkJyxcbiAgUmVxdWVzdElkOiAncmVxdWVzdElkJyxcbiAgTG9naWNhbFJlc291cmNlSWQ6ICdsb2dpY2FsUmVzb3VyY2VJZCcsXG4gIFJlc291cmNlVHlwZTogJ0N1c3RvbTo6QVdTJyxcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVJlcXVlc3QoYm9keVByZWRpY2F0ZTogKGJvZHk6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlUmVzcG9uc2UpID0+IGJvb2xlYW4pIHtcbiAgcmV0dXJuIG5vY2soJ2h0dHBzOi8vbG9jYWxob3N0JylcbiAgICAucHV0KCcvJywgYm9keVByZWRpY2F0ZSlcbiAgICAucmVwbHkoMjAwKTtcbn1cblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIEFXUy5zZXRTREsocmVxdWlyZS5yZXNvbHZlKCdhd3Mtc2RrJykpO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIEFXUy5yZXN0b3JlKCk7XG4gIG5vY2suY2xlYW5BbGwoKTtcbn0pO1xuXG50ZXN0KCdjcmVhdGUgZXZlbnQgd2l0aCBwaHlzaWNhbCByZXNvdXJjZSBpZCBwYXRoJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBsaXN0T2JqZWN0c0Zha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHtcbiAgICBDb250ZW50czogW1xuICAgICAge1xuICAgICAgICBLZXk6ICdmaXJzdC1rZXknLFxuICAgICAgICBFVGFnOiAnZmlyc3Qta2V5LWV0YWcnLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgS2V5OiAnc2Vjb25kLWtleScsXG4gICAgICAgIEVUYWc6ICdzZWNvbmQta2V5LWV0YWcnLFxuICAgICAgfSxcbiAgICBdLFxuICB9IGFzIFNESy5TMy5MaXN0T2JqZWN0c091dHB1dCk7XG5cbiAgQVdTLm1vY2soJ1MzJywgJ2xpc3RPYmplY3RzJywgbGlzdE9iamVjdHNGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IHtcbiAgICAgICAgc2VydmljZTogJ1MzJyxcbiAgICAgICAgYWN0aW9uOiAnbGlzdE9iamVjdHMnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQuZnJvbVJlc3BvbnNlKCdDb250ZW50cy4xLkVUYWcnKSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdzZWNvbmQta2V5LWV0YWcnICYmXG4gICAgYm9keS5EYXRhIVsnQ29udGVudHMuMC5LZXknXSA9PT0gJ2ZpcnN0LWtleScsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGxpc3RPYmplY3RzRmFrZSwge1xuICAgIEJ1Y2tldDogJ215LWJ1Y2tldCcsXG4gIH0pO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgndXBkYXRlIGV2ZW50IHdpdGggcGh5c2ljYWwgcmVzb3VyY2UgaWQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHB1Ymxpc2ggPSBzaW5vbi5mYWtlLnJlc29sdmVzKHt9KTtcblxuICBBV1MubW9jaygnU05TJywgJ3B1Ymxpc2gnLCBwdWJsaXNoKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VVcGRhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ1VwZGF0ZScsXG4gICAgUGh5c2ljYWxSZXNvdXJjZUlkOiAncGh5c2ljYWxSZXNvdXJjZUlkJyxcbiAgICBPbGRSZXNvdXJjZVByb3BlcnRpZXM6IHt9LFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgVXBkYXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdTTlMnLFxuICAgICAgICBhY3Rpb246ICdwdWJsaXNoJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIE1lc3NhZ2U6ICdoZWxsbycsXG4gICAgICAgICAgVG9waWNBcm46ICd0b3BpY2FybicsXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCd0b3BpY2FybicpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3RvcGljYXJuJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdkZWxldGUgZXZlbnQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGxpc3RPYmplY3RzRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTMycsICdsaXN0T2JqZWN0cycsIGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlRGVsZXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdEZWxldGUnLFxuICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogJ3BoeXNpY2FsUmVzb3VyY2VJZCcsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IHtcbiAgICAgICAgc2VydmljZTogJ1MzJyxcbiAgICAgICAgYWN0aW9uOiAnbGlzdE9iamVjdHMnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgQnVja2V0OiAnbXktYnVja2V0JyxcbiAgICAgICAgfSxcbiAgICAgICAgcGh5c2ljYWxSZXNvdXJjZUlkOiBQaHlzaWNhbFJlc291cmNlSWQuZnJvbVJlc3BvbnNlKCdDb250ZW50cy4xLkVUYWcnKSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnICYmXG4gICAgYm9keS5QaHlzaWNhbFJlc291cmNlSWQgPT09ICdwaHlzaWNhbFJlc291cmNlSWQnICYmXG4gICAgT2JqZWN0LmtleXMoYm9keS5EYXRhISkubGVuZ3RoID09PSAwLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdkZWxldGUgZXZlbnQgd2l0aCBEZWxldGUgY2FsbCBhbmQgbm8gcGh5c2ljYWwgcmVzb3VyY2UgaWQgaW4gY2FsbCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgZGVsZXRlUGFyYW1ldGVyRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTU00nLCAnZGVsZXRlUGFyYW1ldGVyJywgZGVsZXRlUGFyYW1ldGVyRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlRGVsZXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdEZWxldGUnLFxuICAgIFBoeXNpY2FsUmVzb3VyY2VJZDogJ3BoeXNpY2FsUmVzb3VyY2VJZCcsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBEZWxldGU6IHtcbiAgICAgICAgc2VydmljZTogJ1NTTScsXG4gICAgICAgIGFjdGlvbjogJ2RlbGV0ZVBhcmFtZXRlcicsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBOYW1lOiAnbXktcGFyYW0nLFxuICAgICAgICB9LFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LlBoeXNpY2FsUmVzb3VyY2VJZCA9PT0gJ3BoeXNpY2FsUmVzb3VyY2VJZCcsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIHNpbm9uLmFzc2VydC5jYWxsZWRXaXRoKGRlbGV0ZVBhcmFtZXRlckZha2UsIHtcbiAgICBOYW1lOiAnbXktcGFyYW0nLFxuICB9KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ2NyZWF0ZSBldmVudCB3aXRoIERlbGV0ZSBjYWxsIG9ubHknLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGRlbGV0ZVBhcmFtZXRlckZha2UgPSBzaW5vbi5mYWtlLnJlc29sdmVzKHt9KTtcblxuICBBV1MubW9jaygnU1NNJywgJ2RlbGV0ZVBhcmFtZXRlcicsIGRlbGV0ZVBhcmFtZXRlckZha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIERlbGV0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnU1NNJyxcbiAgICAgICAgYWN0aW9uOiAnZGVsZXRlUGFyYW1ldGVyJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIE5hbWU6ICdteS1wYXJhbScsXG4gICAgICAgIH0sXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAnbG9naWNhbFJlc291cmNlSWQnLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBzaW5vbi5hc3NlcnQubm90Q2FsbGVkKGRlbGV0ZVBhcmFtZXRlckZha2UpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY2F0Y2ggZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBlcnJvcjogTm9kZUpTLkVycm5vRXhjZXB0aW9uID0gbmV3IEVycm9yKCk7XG4gIGVycm9yLmNvZGUgPSAnTm9TdWNoQnVja2V0JztcbiAgY29uc3QgbGlzdE9iamVjdHNGYWtlID0gc2lub24uZmFrZS5yZWplY3RzKGVycm9yKTtcblxuICBBV1MubW9jaygnUzMnLCAnbGlzdE9iamVjdHMnLCBsaXN0T2JqZWN0c0Zha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgICBhY3Rpb246ICdsaXN0T2JqZWN0cycsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBCdWNrZXQ6ICdteS1idWNrZXQnLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZigncGh5c2ljYWxSZXNvdXJjZUlkJyksXG4gICAgICAgIGlnbm9yZUVycm9yQ29kZXNNYXRjaGluZzogJ05vU3VjaEJ1Y2tldCcsXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAncGh5c2ljYWxSZXNvdXJjZUlkJyAmJlxuICAgIE9iamVjdC5rZXlzKGJvZHkuRGF0YSEpLmxlbmd0aCA9PT0gMCxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdkZWNvZGVzIGJvb2xlYW5zJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdXRJdGVtRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdEeW5hbW9EQicsICdwdXRJdGVtJywgcHV0SXRlbUZha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnRHluYW1vREInLFxuICAgICAgICBhY3Rpb246ICdwdXRJdGVtJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIFRhYmxlTmFtZTogJ3RhYmxlJyxcbiAgICAgICAgICBJdGVtOiB7XG4gICAgICAgICAgICBUcnVlOiB7XG4gICAgICAgICAgICAgIEJPT0w6ICdUUlVFOkJPT0xFQU4nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFRydWVTdHJpbmc6IHtcbiAgICAgICAgICAgICAgUzogJ3RydWUnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEZhbHNlOiB7XG4gICAgICAgICAgICAgIEJPT0w6ICdGQUxTRTpCT09MRUFOJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBGYWxzZVN0cmluZzoge1xuICAgICAgICAgICAgICBTOiAnZmFsc2UnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZigncHV0LWl0ZW0nKSxcbiAgICAgIH0gYXMgQXdzU2RrQ2FsbCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGJvZHkgPT5cbiAgICBib2R5LlN0YXR1cyA9PT0gJ1NVQ0NFU1MnLFxuICApO1xuXG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBzaW5vbi5hc3NlcnQuY2FsbGVkV2l0aChwdXRJdGVtRmFrZSwge1xuICAgIFRhYmxlTmFtZTogJ3RhYmxlJyxcbiAgICBJdGVtOiB7XG4gICAgICBUcnVlOiB7XG4gICAgICAgIEJPT0w6IHRydWUsXG4gICAgICB9LFxuICAgICAgVHJ1ZVN0cmluZzoge1xuICAgICAgICBTOiAndHJ1ZScsXG4gICAgICB9LFxuICAgICAgRmFsc2U6IHtcbiAgICAgICAgQk9PTDogZmFsc2UsXG4gICAgICB9LFxuICAgICAgRmFsc2VTdHJpbmc6IHtcbiAgICAgICAgUzogJ2ZhbHNlJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdyZXN0cmljdCBvdXRwdXQgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgbGlzdE9iamVjdHNGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7XG4gICAgQ29udGVudHM6IFtcbiAgICAgIHtcbiAgICAgICAgS2V5OiAnZmlyc3Qta2V5JyxcbiAgICAgICAgRVRhZzogJ2ZpcnN0LWtleS1ldGFnJyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIEtleTogJ3NlY29uZC1rZXknLFxuICAgICAgICBFVGFnOiAnc2Vjb25kLWtleS1ldGFnJyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSBhcyBTREsuUzMuTGlzdE9iamVjdHNPdXRwdXQpO1xuXG4gIEFXUy5tb2NrKCdTMycsICdsaXN0T2JqZWN0cycsIGxpc3RPYmplY3RzRmFrZSk7XG5cbiAgY29uc3QgZXZlbnQ6IEFXU0xhbWJkYS5DbG91ZEZvcm1hdGlvbkN1c3RvbVJlc291cmNlQ3JlYXRlRXZlbnQgPSB7XG4gICAgLi4uZXZlbnRDb21tb24sXG4gICAgUmVxdWVzdFR5cGU6ICdDcmVhdGUnLFxuICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgU2VydmljZVRva2VuOiAndG9rZW4nLFxuICAgICAgQ3JlYXRlOiB7XG4gICAgICAgIHNlcnZpY2U6ICdTMycsXG4gICAgICAgIGFjdGlvbjogJ2xpc3RPYmplY3RzJyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIEJ1Y2tldDogJ215LWJ1Y2tldCcsXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdpZCcpLFxuICAgICAgICBvdXRwdXRQYXRoOiAnQ29udGVudHMuMCcsXG4gICAgICB9IGFzIEF3c1Nka0NhbGwsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCByZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChib2R5ID0+XG4gICAgYm9keS5TdGF0dXMgPT09ICdTVUNDRVNTJyAmJlxuICAgIGJvZHkuUGh5c2ljYWxSZXNvdXJjZUlkID09PSAnaWQnICYmXG4gICAgYm9keS5EYXRhIVsnQ29udGVudHMuMC5LZXknXSA9PT0gJ2ZpcnN0LWtleScgJiZcbiAgICBib2R5LkRhdGEhWydDb250ZW50cy4xLktleSddID09PSB1bmRlZmluZWQsXG4gICk7XG5cbiAgYXdhaXQgaGFuZGxlcihldmVudCwge30gYXMgQVdTTGFtYmRhLkNvbnRleHQpO1xuXG4gIGV4cGVjdChyZXF1ZXN0LmlzRG9uZSgpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY2FuIHNwZWNpZnkgYXBpVmVyc2lvbiBhbmQgcmVnaW9uJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBwdWJsaXNoRmFrZSA9IHNpbm9uLmZha2UucmVzb2x2ZXMoe30pO1xuXG4gIEFXUy5tb2NrKCdTTlMnLCAncHVibGlzaCcsIHB1Ymxpc2hGYWtlKTtcblxuICBjb25zdCBldmVudDogQVdTTGFtYmRhLkNsb3VkRm9ybWF0aW9uQ3VzdG9tUmVzb3VyY2VDcmVhdGVFdmVudCA9IHtcbiAgICAuLi5ldmVudENvbW1vbixcbiAgICBSZXF1ZXN0VHlwZTogJ0NyZWF0ZScsXG4gICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICBTZXJ2aWNlVG9rZW46ICd0b2tlbicsXG4gICAgICBDcmVhdGU6IHtcbiAgICAgICAgc2VydmljZTogJ1NOUycsXG4gICAgICAgIGFjdGlvbjogJ3B1Ymxpc2gnLFxuICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgTWVzc2FnZTogJ21lc3NhZ2UnLFxuICAgICAgICAgIFRvcGljQXJuOiAndG9waWMnLFxuICAgICAgICB9LFxuICAgICAgICBhcGlWZXJzaW9uOiAnMjAxMC0wMy0zMScsXG4gICAgICAgIHJlZ2lvbjogJ2V1LXdlc3QtMScsXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdpZCcpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycgJiZcbiAgICBib2R5LkRhdGEhLmFwaVZlcnNpb24gPT09ICcyMDEwLTAzLTMxJyAmJlxuICAgIGJvZHkuRGF0YSEucmVnaW9uID09PSAnZXUtd2VzdC0xJyxcbiAgKTtcblxuICBhd2FpdCBoYW5kbGVyKGV2ZW50LCB7fSBhcyBBV1NMYW1iZGEuQ29udGV4dCk7XG5cbiAgZXhwZWN0KHJlcXVlc3QuaXNEb25lKCkpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdmbGF0dGVuIGNvcnJlY3RseSBmbGF0dGVucyBhIG5lc3RlZCBvYmplY3QnLCAoKSA9PiB7XG4gIGV4cGVjdChmbGF0dGVuKHtcbiAgICBhOiB7IGI6ICdjJyB9LFxuICAgIGQ6IFtcbiAgICAgIHsgZTogJ2YnIH0sXG4gICAgICB7IGc6ICdoJywgaTogMSwgajogbnVsbCwgazogeyBsOiBmYWxzZSB9IH0sXG4gICAgXSxcbiAgfSkpLnRvRXF1YWwoe1xuICAgICdhLmInOiAnYycsXG4gICAgJ2QuMC5lJzogJ2YnLFxuICAgICdkLjEuZyc6ICdoJyxcbiAgICAnZC4xLmknOiAxLFxuICAgICdkLjEuaic6IG51bGwsXG4gICAgJ2QuMS5rLmwnOiBmYWxzZSxcbiAgfSk7XG59KTtcblxudGVzdCgnZmxhdHRlbiBjb3JyZWN0bHkgZmxhdHRlbnMgYW4gb2JqZWN0IHdpdGggYnVmZmVycycsICgpID0+IHtcbiAgZXhwZWN0KGZsYXR0ZW4oe1xuICAgIGJvZHk6IEJ1ZmZlci5mcm9tKCdib2R5JyksXG4gICAgbmVzdGVkOiB7XG4gICAgICBidWZmZXI6IEJ1ZmZlci5mcm9tKCdidWZmZXInKSxcbiAgICAgIGFycmF5OiBbXG4gICAgICAgIEJ1ZmZlci5mcm9tKCdhcnJheS4wJyksXG4gICAgICAgIEJ1ZmZlci5mcm9tKCdhcnJheS4xJyksXG4gICAgICBdLFxuICAgIH0sXG4gIH0pKS50b0VxdWFsKHtcbiAgICAnYm9keSc6ICdib2R5JyxcbiAgICAnbmVzdGVkLmJ1ZmZlcic6ICdidWZmZXInLFxuICAgICduZXN0ZWQuYXJyYXkuMCc6ICdhcnJheS4wJyxcbiAgICAnbmVzdGVkLmFycmF5LjEnOiAnYXJyYXkuMScsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2luc3RhbGxzIHRoZSBsYXRlc3QgU0RLJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCB0bXBQYXRoID0gJy90bXAvbm9kZV9tb2R1bGVzL2F3cy1zZGsnO1xuXG4gIC8vIFN5bWxpbmsgdG8gbm9ybWFsIFNESyB0byBiZSBhYmxlIHRvIGNhbGwgQVdTLnNldFNESygpXG4gIGF3YWl0IGZzLmVuc3VyZURpcignL3RtcC9ub2RlX21vZHVsZXMnKTtcbiAgYXdhaXQgZnMuc3ltbGluayhyZXF1aXJlLnJlc29sdmUoJ2F3cy1zZGsnKSwgdG1wUGF0aCk7XG4gIEFXUy5zZXRTREsodG1wUGF0aCk7XG5cbiAgLy8gTm93IHJlbW92ZSB0aGUgc3ltbGluayBhbmQgbGV0IHRoZSBoYW5kbGVyIGluc3RhbGwgaXRcbiAgYXdhaXQgZnMudW5saW5rKHRtcFBhdGgpO1xuXG4gIGNvbnN0IHB1Ymxpc2hGYWtlID0gc2lub24uZmFrZS5yZXNvbHZlcyh7fSk7XG5cbiAgQVdTLm1vY2soJ1NOUycsICdwdWJsaXNoJywgcHVibGlzaEZha2UpO1xuXG4gIGNvbnN0IGV2ZW50OiBBV1NMYW1iZGEuQ2xvdWRGb3JtYXRpb25DdXN0b21SZXNvdXJjZUNyZWF0ZUV2ZW50ID0ge1xuICAgIC4uLmV2ZW50Q29tbW9uLFxuICAgIFJlcXVlc3RUeXBlOiAnQ3JlYXRlJyxcbiAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgIFNlcnZpY2VUb2tlbjogJ3Rva2VuJyxcbiAgICAgIENyZWF0ZToge1xuICAgICAgICBzZXJ2aWNlOiAnU05TJyxcbiAgICAgICAgYWN0aW9uOiAncHVibGlzaCcsXG4gICAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgICBNZXNzYWdlOiAnbWVzc2FnZScsXG4gICAgICAgICAgVG9waWNBcm46ICd0b3BpYycsXG4gICAgICAgIH0sXG4gICAgICAgIHBoeXNpY2FsUmVzb3VyY2VJZDogUGh5c2ljYWxSZXNvdXJjZUlkLm9mKCdpZCcpLFxuICAgICAgfSBhcyBBd3NTZGtDYWxsLFxuICAgICAgSW5zdGFsbExhdGVzdEF3c1NkazogJ3RydWUnLFxuICAgIH0sXG4gIH07XG5cbiAgY29uc3QgcmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QoYm9keSA9PlxuICAgIGJvZHkuU3RhdHVzID09PSAnU1VDQ0VTUycsXG4gICk7XG5cbiAgLy8gUmVzZXQgdG8gJ2ZhbHNlJyBzbyB0aGF0IHRoZSBuZXh0IHJ1biB3aWxsIHJlaW5zdGFsbCBhd3Mtc2RrXG4gIGZvcmNlU2RrSW5zdGFsbGF0aW9uKCk7XG4gIGF3YWl0IGhhbmRsZXIoZXZlbnQsIHt9IGFzIEFXU0xhbWJkYS5Db250ZXh0KTtcblxuICBleHBlY3QocmVxdWVzdC5pc0RvbmUoKSkudG9CZVRydXRoeSgpO1xuXG4gIGV4cGVjdCgoKSA9PiByZXF1aXJlLnJlc29sdmUodG1wUGF0aCkpLm5vdC50b1Rocm93KCk7XG5cbiAgLy8gY2xlYW4gdXAgYXdzLXNkayBpbnN0YWxsXG4gIGF3YWl0IGZzLnJlbW92ZSh0bXBQYXRoKTtcbn0pO1xuIl19