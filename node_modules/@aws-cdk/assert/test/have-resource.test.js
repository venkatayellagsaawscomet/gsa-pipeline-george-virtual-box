"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const path_1 = require("path");
const cxschema = require("@aws-cdk/cloud-assembly-schema");
const cxapi = require("@aws-cdk/cx-api");
const index_1 = require("../lib/index");
test('support resource with no properties', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
            },
        },
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource'))).not.toThrowError();
});
test('haveResource tells you about mismatched fields', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: 'somevalue',
                },
            },
        },
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: 'othervalue',
        }));
    }).toThrowError(/PropA/);
});
test('haveResource value matching is strict by default', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'This is unexpected, so the value of PropA doesn\'t strictly match - it shouldn\'t pass',
                    },
                    PropB: 'This property is unexpected, but it\'s allowed',
                },
            },
        },
    });
    expect(() => {
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: {
                foo: 'somevalue',
            },
        }));
    }).toThrowError(/PropA/);
});
test('haveResource allows to opt in value extension', () => {
    const synthStack = mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: {
                    PropA: {
                        foo: 'somevalue',
                        bar: 'Additional value is permitted, as we opted in',
                    },
                    PropB: 'Additional properties is always okay!',
                },
            },
        },
    });
    expect(() => index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
        PropA: {
            foo: 'somevalue',
        },
    }, undefined, true))).not.toThrowError();
});
describe('property absence', () => {
    test('pass on absence', () => {
        const synthStack = mkSomeResource({
            Prop: 'somevalue',
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            PropA: index_1.ABSENT,
        }));
    });
    test('fail on presence', () => {
        const synthStack = mkSomeResource({
            PropA: 3,
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                PropA: index_1.ABSENT,
            }));
        }).toThrowError(/PropA/);
    });
    test('pass on deep absence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            },
        });
        index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
            Deep: {
                Prop: 'somevalue',
                PropA: index_1.ABSENT,
            },
        }));
    });
    test('fail on deep presence', () => {
        const synthStack = mkSomeResource({
            Deep: {
                Prop: 'somevalue',
            },
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                Deep: {
                    Prop: index_1.ABSENT,
                },
            }));
        }).toThrowError(/Prop/);
    });
    test('can use matcher to test for list element', () => {
        const synthStack = mkSomeResource({
            List: [
                { Prop: 'distraction' },
                { Prop: 'goal' },
            ],
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                List: index_1.arrayWith({ Prop: 'goal' }),
            }));
        }).not.toThrowError();
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                List: index_1.arrayWith({ Prop: 'missme' }),
            }));
        }).toThrowError(/Array did not contain expected element/);
    });
    test('arrayContaining must match all elements in any order', () => {
        const synthStack = mkSomeResource({
            List: ['a', 'b'],
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                List: index_1.arrayWith('b', 'a'),
            }));
        }).not.toThrowError();
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResource('Some::Resource', {
                List: index_1.arrayWith('a', 'c'),
            }));
        }).toThrowError(/Array did not contain expected element/);
    });
    test('exactValue escapes from deep fuzzy matching', () => {
        const synthStack = mkSomeResource({
            Deep: {
                PropA: 'A',
                PropB: 'B',
            },
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResourceLike('Some::Resource', {
                Deep: {
                    PropA: 'A',
                },
            }));
        }).not.toThrowError();
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResourceLike('Some::Resource', {
                Deep: index_1.exactValue({
                    PropA: 'A',
                }),
            }));
        }).toThrowError(/Unexpected keys present in object/);
    });
    /**
     * Backwards compatibility test
     *
     * If we had designed this with a matcher library from the start, we probably wouldn't
     * have had this behavior, but here we are.
     *
     * Historically, when we do `haveResourceLike` (which maps to `objectContainingDeep`) with
     * a pattern containing lists of objects, the objects inside the list are also matched
     * as 'containing' keys (instead of having to completely 'match' the pattern objects).
     *
     * People will have written assertions depending on this behavior, so we have to maintain
     * it.
     */
    test('objectContainingDeep has deep effect through lists', () => {
        const synthStack = mkSomeResource({
            List: [
                {
                    PropA: 'A',
                    PropB: 'B',
                },
                {
                    PropA: 'A',
                    PropB: 'B',
                },
            ],
        });
        expect(() => {
            index_1.expect(synthStack).to(index_1.haveResourceLike('Some::Resource', {
                List: [
                    { PropA: 'A' },
                    { PropB: 'B' },
                ],
            }));
        }).not.toThrowError();
    });
});
function mkStack(template) {
    const assembly = new cxapi.CloudAssemblyBuilder();
    assembly.addArtifact('test', {
        type: cxschema.ArtifactType.AWS_CLOUDFORMATION_STACK,
        environment: cxapi.EnvironmentUtils.format('123456789', 'us-west-2'),
        properties: {
            templateFile: 'template.json',
        },
    });
    fs_1.writeFileSync(path_1.join(assembly.outdir, 'template.json'), JSON.stringify(template));
    return assembly.buildAssembly().getStackByName('test');
}
function mkSomeResource(props) {
    return mkStack({
        Resources: {
            SomeResource: {
                Type: 'Some::Resource',
                Properties: props,
            },
        },
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGF2ZS1yZXNvdXJjZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaGF2ZS1yZXNvdXJjZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQW1DO0FBQ25DLCtCQUE0QjtBQUM1QiwyREFBMkQ7QUFDM0QseUNBQXlDO0FBQ3pDLHdDQUFrSDtBQUVsSCxJQUFJLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUN6QixTQUFTLEVBQUU7WUFDVCxZQUFZLEVBQUU7Z0JBQ1osSUFBSSxFQUFFLGdCQUFnQjthQUN2QjtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLGNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxFQUFFLENBQUMsb0JBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDNUYsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0RBQWdELEVBQUUsR0FBRyxFQUFFO0lBQzFELE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQztRQUN6QixTQUFTLEVBQUU7WUFDVCxZQUFZLEVBQUU7Z0JBQ1osSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsVUFBVSxFQUFFO29CQUNWLEtBQUssRUFBRSxXQUFXO2lCQUNuQjthQUNGO1NBQ0Y7S0FDRixDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsR0FBRyxFQUFFO1FBQ1YsY0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxvQkFBWSxDQUFDLGdCQUFnQixFQUFFO1lBQ3RELEtBQUssRUFBRSxZQUFZO1NBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGtEQUFrRCxFQUFFLEdB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LENBQUMsTUFBTSxFQUFFO1FBQzNCLElBQUksRUFBRSxRQUFRLENBQUMsWUFBWSxDQUFDLHdCQUF3QjtRQUNwRCxXQUFXLEVBQUUsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsV0FBVyxDQUFDO1FBQ3BFLFVBQVUsRUFBRTtZQUNWLFlBQVksRUFBRSxlQUFlO1NBQzlCO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsa0JBQWEsQ0FBQyxXQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxlQUFlLENBQUMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDaEYsT0FBTyxRQUFRLENBQUMsYUFBYSxFQUFFLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3pELENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxLQUFVO0lBQ2hDLE9BQU8sT0FBTyxDQUFDO1FBQ2IsU0FBUyxFQUFFO1lBQ1QsWUFBWSxFQUFFO2dCQUNaLElBQUksRUFBRSxnQkFBZ0I7Z0JBQ3RCLFVBQVUsRUFBRSxLQUFLO2FBQ2xCO1NBQ0Y7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgd3JpdGVGaWxlU3luYyB9IGZyb20gJ2ZzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGN4c2NoZW1hIGZyb20gJ0Bhd3MtY2RrL2Nsb3VkLWFzc2VtYmx5LXNjaGVtYSc7XG5pbXBvcnQgKiBhcyBjeGFwaSBmcm9tICdAYXdzLWNkay9jeC1hcGknO1xuaW1wb3J0IHsgQUJTRU5ULCBhcnJheVdpdGgsIGV4YWN0VmFsdWUsIGV4cGVjdCBhcyBjZGtFeHBlY3QsIGhhdmVSZXNvdXJjZSwgaGF2ZVJlc291cmNlTGlrZSB9IGZyb20gJy4uL2xpYi9pbmRleCc7XG5cbnRlc3QoJ3N1cHBvcnQgcmVzb3VyY2Ugd2l0aCBubyBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICBjb25zdCBzeW50aFN0YWNrID0gbWtTdGFjayh7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBTb21lUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG4gIGV4cGVjdCgoKSA9PiBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScpKSkubm90LnRvVGhyb3dFcnJvcigpO1xufSk7XG5cbnRlc3QoJ2hhdmVSZXNvdXJjZSB0ZWxscyB5b3UgYWJvdXQgbWlzbWF0Y2hlZCBmaWVsZHMnLCAoKSA9PiB7XG4gIGNvbnN0IHN5bnRoU3RhY2sgPSBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgUHJvcEE6ICdzb21ldmFsdWUnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgUHJvcEE6ICdvdGhlcnZhbHVlJyxcbiAgICB9KSk7XG4gIH0pLnRvVGhyb3dFcnJvcigvUHJvcEEvKTtcbn0pO1xuXG50ZXN0KCdoYXZlUmVzb3VyY2UgdmFsdWUgbWF0Y2hpbmcgaXMgc3RyaWN0IGJ5IGRlZmF1bHQnLCAoKSA9PiB7XG4gIGNvbnN0IHN5bnRoU3RhY2sgPSBta1N0YWNrKHtcbiAgICBSZXNvdXJjZXM6IHtcbiAgICAgIFNvbWVSZXNvdXJjZToge1xuICAgICAgICBUeXBlOiAnU29tZTo6UmVzb3VyY2UnLFxuICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgUHJvcEE6IHtcbiAgICAgICAgICAgIGZvbzogJ3NvbWV2YWx1ZScsXG4gICAgICAgICAgICBiYXI6ICdUaGlzIGlzIHVuZXhwZWN0ZWQsIHNvIHRoZSB2YWx1ZSBvZiBQcm9wQSBkb2VzblxcJ3Qgc3RyaWN0bHkgbWF0Y2ggLSBpdCBzaG91bGRuXFwndCBwYXNzJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFByb3BCOiAnVGhpcyBwcm9wZXJ0eSBpcyB1bmV4cGVjdGVkLCBidXQgaXRcXCdzIGFsbG93ZWQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBleHBlY3QoKCkgPT4ge1xuICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgUHJvcEE6IHtcbiAgICAgICAgZm9vOiAnc29tZXZhbHVlJyxcbiAgICAgIH0sXG4gICAgfSkpO1xuICB9KS50b1Rocm93RXJyb3IoL1Byb3BBLyk7XG59KTtcblxudGVzdCgnaGF2ZVJlc291cmNlIGFsbG93cyB0byBvcHQgaW4gdmFsdWUgZXh0ZW5zaW9uJywgKCkgPT4ge1xuICBjb25zdCBzeW50aFN0YWNrID0gbWtTdGFjayh7XG4gICAgUmVzb3VyY2VzOiB7XG4gICAgICBTb21lUmVzb3VyY2U6IHtcbiAgICAgICAgVHlwZTogJ1NvbWU6OlJlc291cmNlJyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIFByb3BBOiB7XG4gICAgICAgICAgICBmb286ICdzb21ldmFsdWUnLFxuICAgICAgICAgICAgYmFyOiAnQWRkaXRpb25hbCB2YWx1ZSBpcyBwZXJtaXR0ZWQsIGFzIHdlIG9wdGVkIGluJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFByb3BCOiAnQWRkaXRpb25hbCBwcm9wZXJ0aWVzIGlzIGFsd2F5cyBva2F5IScsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGV4cGVjdCgoKSA9PlxuICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2UoJ1NvbWU6OlJlc291cmNlJywge1xuICAgICAgUHJvcEE6IHtcbiAgICAgICAgZm9vOiAnc29tZXZhbHVlJyxcbiAgICAgIH0sXG4gICAgfSwgdW5kZWZpbmVkLCB0cnVlKSksXG4gICkubm90LnRvVGhyb3dFcnJvcigpO1xufSk7XG5cbmRlc2NyaWJlKCdwcm9wZXJ0eSBhYnNlbmNlJywgKCkgPT4ge1xuICB0ZXN0KCdwYXNzIG9uIGFic2VuY2UnLCAoKSA9PiB7XG4gICAgY29uc3Qgc3ludGhTdGFjayA9IG1rU29tZVJlc291cmNlKHtcbiAgICAgIFByb3A6ICdzb21ldmFsdWUnLFxuICAgIH0pO1xuXG4gICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICBQcm9wQTogQUJTRU5ULFxuICAgIH0pKTtcbiAgfSk7XG5cbiAgdGVzdCgnZmFpbCBvbiBwcmVzZW5jZScsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgUHJvcEE6IDMsXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIFByb3BBOiBBQlNFTlQsXG4gICAgICB9KSk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9Qcm9wQS8pO1xuICB9KTtcblxuICB0ZXN0KCdwYXNzIG9uIGRlZXAgYWJzZW5jZScsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgRGVlcDoge1xuICAgICAgICBQcm9wOiAnc29tZXZhbHVlJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgIERlZXA6IHtcbiAgICAgICAgUHJvcDogJ3NvbWV2YWx1ZScsXG4gICAgICAgIFByb3BBOiBBQlNFTlQsXG4gICAgICB9LFxuICAgIH0pKTtcbiAgfSk7XG5cbiAgdGVzdCgnZmFpbCBvbiBkZWVwIHByZXNlbmNlJywgKCkgPT4ge1xuICAgIGNvbnN0IHN5bnRoU3RhY2sgPSBta1NvbWVSZXNvdXJjZSh7XG4gICAgICBEZWVwOiB7XG4gICAgICAgIFByb3A6ICdzb21ldmFsdWUnLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgICAgRGVlcDoge1xuICAgICAgICAgIFByb3A6IEFCU0VOVCxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcbiAgICB9KS50b1Rocm93RXJyb3IoL1Byb3AvKTtcbiAgfSk7XG5cbiAgdGVzdCgnY2FuIHVzZSBtYXRjaGVyIHRvIHRlc3QgZm9yIGxpc3QgZWxlbWVudCcsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgTGlzdDogW1xuICAgICAgICB7IFByb3A6ICdkaXN0cmFjdGlvbicgfSxcbiAgICAgICAgeyBQcm9wOiAnZ29hbCcgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIExpc3Q6IGFycmF5V2l0aCh7IFByb3A6ICdnb2FsJyB9KSxcbiAgICAgIH0pKTtcbiAgICB9KS5ub3QudG9UaHJvd0Vycm9yKCk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIExpc3Q6IGFycmF5V2l0aCh7IFByb3A6ICdtaXNzbWUnIH0pLFxuICAgICAgfSkpO1xuICAgIH0pLnRvVGhyb3dFcnJvcigvQXJyYXkgZGlkIG5vdCBjb250YWluIGV4cGVjdGVkIGVsZW1lbnQvKTtcbiAgfSk7XG5cbiAgdGVzdCgnYXJyYXlDb250YWluaW5nIG11c3QgbWF0Y2ggYWxsIGVsZW1lbnRzIGluIGFueSBvcmRlcicsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgTGlzdDogWydhJywgJ2InXSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgICAgTGlzdDogYXJyYXlXaXRoKCdiJywgJ2EnKSxcbiAgICAgIH0pKTtcbiAgICB9KS5ub3QudG9UaHJvd0Vycm9yKCk7XG5cbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgY2RrRXhwZWN0KHN5bnRoU3RhY2spLnRvKGhhdmVSZXNvdXJjZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIExpc3Q6IGFycmF5V2l0aCgnYScsICdjJyksXG4gICAgICB9KSk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9BcnJheSBkaWQgbm90IGNvbnRhaW4gZXhwZWN0ZWQgZWxlbWVudC8pO1xuICB9KTtcblxuICB0ZXN0KCdleGFjdFZhbHVlIGVzY2FwZXMgZnJvbSBkZWVwIGZ1enp5IG1hdGNoaW5nJywgKCkgPT4ge1xuICAgIGNvbnN0IHN5bnRoU3RhY2sgPSBta1NvbWVSZXNvdXJjZSh7XG4gICAgICBEZWVwOiB7XG4gICAgICAgIFByb3BBOiAnQScsXG4gICAgICAgIFByb3BCOiAnQicsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgICAgRGVlcDoge1xuICAgICAgICAgIFByb3BBOiAnQScsXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG4gICAgfSkubm90LnRvVGhyb3dFcnJvcigpO1xuXG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIGNka0V4cGVjdChzeW50aFN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdTb21lOjpSZXNvdXJjZScsIHtcbiAgICAgICAgRGVlcDogZXhhY3RWYWx1ZSh7XG4gICAgICAgICAgUHJvcEE6ICdBJyxcbiAgICAgICAgfSksXG4gICAgICB9KSk7XG4gICAgfSkudG9UaHJvd0Vycm9yKC9VbmV4cGVjdGVkIGtleXMgcHJlc2VudCBpbiBvYmplY3QvKTtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IHRlc3RcbiAgICpcbiAgICogSWYgd2UgaGFkIGRlc2lnbmVkIHRoaXMgd2l0aCBhIG1hdGNoZXIgbGlicmFyeSBmcm9tIHRoZSBzdGFydCwgd2UgcHJvYmFibHkgd291bGRuJ3RcbiAgICogaGF2ZSBoYWQgdGhpcyBiZWhhdmlvciwgYnV0IGhlcmUgd2UgYXJlLlxuICAgKlxuICAgKiBIaXN0b3JpY2FsbHksIHdoZW4gd2UgZG8gYGhhdmVSZXNvdXJjZUxpa2VgICh3aGljaCBtYXBzIHRvIGBvYmplY3RDb250YWluaW5nRGVlcGApIHdpdGhcbiAgICogYSBwYXR0ZXJuIGNvbnRhaW5pbmcgbGlzdHMgb2Ygb2JqZWN0cywgdGhlIG9iamVjdHMgaW5zaWRlIHRoZSBsaXN0IGFyZSBhbHNvIG1hdGNoZWRcbiAgICogYXMgJ2NvbnRhaW5pbmcnIGtleXMgKGluc3RlYWQgb2YgaGF2aW5nIHRvIGNvbXBsZXRlbHkgJ21hdGNoJyB0aGUgcGF0dGVybiBvYmplY3RzKS5cbiAgICpcbiAgICogUGVvcGxlIHdpbGwgaGF2ZSB3cml0dGVuIGFzc2VydGlvbnMgZGVwZW5kaW5nIG9uIHRoaXMgYmVoYXZpb3IsIHNvIHdlIGhhdmUgdG8gbWFpbnRhaW5cbiAgICogaXQuXG4gICAqL1xuICB0ZXN0KCdvYmplY3RDb250YWluaW5nRGVlcCBoYXMgZGVlcCBlZmZlY3QgdGhyb3VnaCBsaXN0cycsICgpID0+IHtcbiAgICBjb25zdCBzeW50aFN0YWNrID0gbWtTb21lUmVzb3VyY2Uoe1xuICAgICAgTGlzdDogW1xuICAgICAgICB7XG4gICAgICAgICAgUHJvcEE6ICdBJyxcbiAgICAgICAgICBQcm9wQjogJ0InLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgUHJvcEE6ICdBJyxcbiAgICAgICAgICBQcm9wQjogJ0InLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICBjZGtFeHBlY3Qoc3ludGhTdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnU29tZTo6UmVzb3VyY2UnLCB7XG4gICAgICAgIExpc3Q6IFtcbiAgICAgICAgICB7IFByb3BBOiAnQScgfSxcbiAgICAgICAgICB7IFByb3BCOiAnQicgfSxcbiAgICAgICAgXSxcbiAgICAgIH0pKTtcbiAgICB9KS5ub3QudG9UaHJvd0Vycm9yKCk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIG1rU3RhY2sodGVtcGxhdGU6IGFueSk6IGN4YXBpLkNsb3VkRm9ybWF0aW9uU3RhY2tBcnRpZmFjdCB7XG4gIGNvbnN0IGFzc2VtYmx5ID0gbmV3IGN4YXBpLkNsb3VkQXNzZW1ibHlCdWlsZGVyKCk7XG4gIGFzc2VtYmx5LmFkZEFydGlmYWN0KCd0ZXN0Jywge1xuICAgIHR5cGU6IGN4c2NoZW1hLkFydGlmYWN0VHlwZS5BV1NfQ0xPVURGT1JNQVRJT05fU1RBQ0ssXG4gICAgZW52aXJvbm1lbnQ6IGN4YXBpLkVudmlyb25tZW50VXRpbHMuZm9ybWF0KCcxMjM0NTY3ODknLCAndXMtd2VzdC0yJyksXG4gICAgcHJvcGVydGllczoge1xuICAgICAgdGVtcGxhdGVGaWxlOiAndGVtcGxhdGUuanNvbicsXG4gICAgfSxcbiAgfSk7XG5cbiAgd3JpdGVGaWxlU3luYyhqb2luKGFzc2VtYmx5Lm91dGRpciwgJ3RlbXBsYXRlLmpzb24nKSwgSlNPTi5zdHJpbmdpZnkodGVtcGxhdGUpKTtcbiAgcmV0dXJuIGFzc2VtYmx5LmJ1aWxkQXNzZW1ibHkoKS5nZXRTdGFja0J5TmFtZSgndGVzdCcpO1xufVxuXG5mdW5jdGlvbiBta1NvbWVSZXNvdXJjZShwcm9wczogYW55KTogY3hhcGkuQ2xvdWRGb3JtYXRpb25TdGFja0FydGlmYWN0IHtcbiAgcmV0dXJuIG1rU3RhY2soe1xuICAgIFJlc291cmNlczoge1xuICAgICAgU29tZVJlc291cmNlOiB7XG4gICAgICAgIFR5cGU6ICdTb21lOjpSZXNvdXJjZScsXG4gICAgICAgIFByb3BlcnRpZXM6IHByb3BzLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcbn0iXX0=