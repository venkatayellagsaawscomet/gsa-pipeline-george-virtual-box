"use strict";
const assert_1 = require("@aws-cdk/assert");
const iam = require("@aws-cdk/aws-iam");
const kms = require("@aws-cdk/aws-kms");
const s3 = require("@aws-cdk/aws-s3");
const cdk = require("@aws-cdk/core");
const codebuild = require("../lib");
module.exports = {
    'Test Reports Groups': {
        'get created with type=TEST and exportConfig=NO_EXPORT by default'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "NO_EXPORT",
                    "S3Destination": assert_1.ABSENT,
                },
            }));
            test.done();
        },
        'can be imported by name'(test) {
            const stack = new cdk.Stack();
            const reportGroup = codebuild.ReportGroup.fromReportGroupName(stack, 'ReportGroup', 'my-report-group');
            const role = new iam.Role(stack, 'Role', {
                assumedBy: new iam.AnyPrincipal(),
            });
            role.addToPolicy(new iam.PolicyStatement({
                actions: ['codebuild:*'],
                resources: [reportGroup.reportGroupArn],
            }));
            test.equal(reportGroup.reportGroupName, 'my-report-group');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::IAM::Policy', {
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Action": "codebuild:*",
                            "Resource": {
                                "Fn::Join": ["", [
                                        "arn:",
                                        { "Ref": "AWS::Partition" },
                                        ":codebuild:",
                                        { "Ref": "AWS::Region" },
                                        ":",
                                        { "Ref": "AWS::AccountId" },
                                        ":report-group/my-report-group",
                                    ]],
                            },
                        },
                    ],
                },
            }));
            test.done();
        },
        'specify exportConfig=S3 when providing an exportBucket'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                exportBucket: s3.Bucket.fromBucketName(stack, 'Bucket', 'my-bucket'),
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "S3",
                    "S3Destination": {
                        "Bucket": "my-bucket",
                        "EncryptionKey": assert_1.ABSENT,
                        "EncryptionDisabled": assert_1.ABSENT,
                        "Packaging": assert_1.ABSENT,
                    },
                },
            }));
            test.done();
        },
        'specify encryptionKey in ExportConfig.S3Destination if exportBucket has a Key'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                exportBucket: s3.Bucket.fromBucketAttributes(stack, 'Bucket', {
                    bucketName: 'my-bucket',
                    encryptionKey: kms.Key.fromKeyArn(stack, 'Key', 'arn:aws:kms:us-east-1:123456789012:key/my-key'),
                }),
                zipExport: true,
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "Type": "TEST",
                "ExportConfig": {
                    "ExportConfigType": "S3",
                    "S3Destination": {
                        "Bucket": "my-bucket",
                        "EncryptionDisabled": false,
                        "EncryptionKey": "arn:aws:kms:us-east-1:123456789012:key/my-key",
                        "Packaging": "ZIP",
                    },
                },
            }));
            test.done();
        },
        'get created with RemovalPolicy.RETAIN by default'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup');
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "DeletionPolicy": "Retain",
                "UpdateReplacePolicy": "Retain",
            }, assert_1.ResourcePart.CompleteDefinition));
            test.done();
        },
        'can be created with RemovalPolicy.DESTROY'(test) {
            const stack = new cdk.Stack();
            new codebuild.ReportGroup(stack, 'ReportGroup', {
                removalPolicy: cdk.RemovalPolicy.DESTROY,
            });
            assert_1.expect(stack).to(assert_1.haveResourceLike('AWS::CodeBuild::ReportGroup', {
                "DeletionPolicy": "Delete",
                "UpdateReplacePolicy": "Delete",
            }, assert_1.ResourcePart.CompleteDefinition));
            test.done();
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC5yZXBvcnQtZ3JvdXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ0ZXN0LnJlcG9ydC1ncm91cC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNENBQWlGO0FBQ2pGLHdDQUF3QztBQUN4Qyx3Q0FBd0M7QUFDeEMsc0NBQXNDO0FBQ3RDLHFDQUFxQztBQUVyQyxvQ0FBb0M7QUFLcEMsaUJBQVM7SUFDUCxxQkFBcUIsRUFBRTtRQUNyQixrRUFBa0UsQ0FBQyxJQUFVO1lBQzNFLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRTlCLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFFaEQsZUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyx5QkFBZ0IsQ0FBQyw2QkFBNkIsRUFBRTtnQkFDL0QsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsY0FBYyxFQUFFO29CQUNkLGtCQUFrQixFQUFFLFdBQVc7b0JBQy9CLGVBQWUsRUFBRSxlQUFNO2lCQUN4QjthQUNGLENBQUMsQ0FBQyxDQUFDO1lBRUosSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2QsQ0FBQztRQUVELHlCQUF5QixDQUFDLElBQVU7WUFDbEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFFOUIsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQ2pFLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBRXBDLE1BQU0sSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO2dCQUN2QyxTQUFTLEVBQUUsSUFBSSxHQUFHLENBQUMsWUFBWSxFQUFFO2FBQ2xDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLENBQUMsZUFB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LEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUU5QixJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBRWhELGVBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMseUJBQWdCLENBQUMsNkJBQTZCLEVBQUU7Z0JBQy9ELGdCQUFnQixFQUFFLFFBQVE7Z0JBQzFCLHFCQUFxQixFQUFFLFFBQVE7YUFDaEMsRUFBRSxxQkFBWSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQztZQUVyQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZCxDQUFDO1FBRUQsMkNBQTJDLENBQUMsSUFBVTtZQUNwRCxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUU5QixJQUFJLFNBQVMsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRTtnQkFDOUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTzthQUN6QyxDQUFDLENBQUM7WUFFSCxlQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLHlCQUFnQixDQUFDLDZCQUE2QixFQUFFO2dCQUMvRCxnQkFBZ0IsRUFBRSxRQUFRO2dCQUMxQixxQkFBcUIsRUFBRSxRQUFRO2FBQ2hDLEVBQUUscUJBQVksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7WUFFckMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2QsQ0FBQztLQUNGO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFCU0VOVCwgZXhwZWN0LCBoYXZlUmVzb3VyY2VMaWtlLCBSZXNvdXJjZVBhcnQgfSBmcm9tICdAYXdzLWNkay9hc3NlcnQnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMga21zIGZyb20gJ0Bhd3MtY2RrL2F3cy1rbXMnO1xuaW1wb3J0ICogYXMgczMgZnJvbSAnQGF3cy1jZGsvYXdzLXMzJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCB7IFRlc3QgfSBmcm9tICdub2RldW5pdCc7XG5pbXBvcnQgKiBhcyBjb2RlYnVpbGQgZnJvbSAnLi4vbGliJztcblxuLyogZXNsaW50LWRpc2FibGUgcXVvdGUtcHJvcHMgKi9cbi8qIGVzbGludC1kaXNhYmxlIHF1b3RlcyAqL1xuXG5leHBvcnQgPSB7XG4gICdUZXN0IFJlcG9ydHMgR3JvdXBzJzoge1xuICAgICdnZXQgY3JlYXRlZCB3aXRoIHR5cGU9VEVTVCBhbmQgZXhwb3J0Q29uZmlnPU5PX0VYUE9SVCBieSBkZWZhdWx0Jyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgbmV3IGNvZGVidWlsZC5SZXBvcnRHcm91cChzdGFjaywgJ1JlcG9ydEdyb3VwJyk7XG5cbiAgICAgIGV4cGVjdChzdGFjaykudG8oaGF2ZVJlc291cmNlTGlrZSgnQVdTOjpDb2RlQnVpbGQ6OlJlcG9ydEdyb3VwJywge1xuICAgICAgICBcIlR5cGVcIjogXCJURVNUXCIsXG4gICAgICAgIFwiRXhwb3J0Q29uZmlnXCI6IHtcbiAgICAgICAgICBcIkV4cG9ydENvbmZpZ1R5cGVcIjogXCJOT19FWFBPUlRcIixcbiAgICAgICAgICBcIlMzRGVzdGluYXRpb25cIjogQUJTRU5ULFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ2NhbiBiZSBpbXBvcnRlZCBieSBuYW1lJyh0ZXN0OiBUZXN0KSB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcblxuICAgICAgY29uc3QgcmVwb3J0R3JvdXAgPSBjb2RlYnVpbGQuUmVwb3J0R3JvdXAuZnJvbVJlcG9ydEdyb3VwTmFtZShzdGFjayxcbiAgICAgICAgJ1JlcG9ydEdyb3VwJywgJ215LXJlcG9ydC1ncm91cCcpO1xuXG4gICAgICBjb25zdCByb2xlID0gbmV3IGlhbS5Sb2xlKHN0YWNrLCAnUm9sZScsIHtcbiAgICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLkFueVByaW5jaXBhbCgpLFxuICAgICAgfSk7XG4gICAgICByb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydjb2RlYnVpbGQ6KiddLFxuICAgICAgICByZXNvdXJjZXM6IFtyZXBvcnRHcm91cC5yZXBvcnRHcm91cEFybl0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZXF1YWwocmVwb3J0R3JvdXAucmVwb3J0R3JvdXBOYW1lLCAnbXktcmVwb3J0LWdyb3VwJyk7XG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6SUFNOjpQb2xpY3knLCB7XG4gICAgICAgIFwiUG9saWN5RG9jdW1lbnRcIjoge1xuICAgICAgICAgIFwiU3RhdGVtZW50XCI6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgXCJBY3Rpb25cIjogXCJjb2RlYnVpbGQ6KlwiLFxuICAgICAgICAgICAgICBcIlJlc291cmNlXCI6IHtcbiAgICAgICAgICAgICAgICBcIkZuOjpKb2luXCI6IFtcIlwiLCBbXG4gICAgICAgICAgICAgICAgICBcImFybjpcIixcbiAgICAgICAgICAgICAgICAgIHsgXCJSZWZcIjogXCJBV1M6OlBhcnRpdGlvblwiIH0sXG4gICAgICAgICAgICAgICAgICBcIjpjb2RlYnVpbGQ6XCIsXG4gICAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IFwiQVdTOjpSZWdpb25cIiB9LFxuICAgICAgICAgICAgICAgICAgXCI6XCIsXG4gICAgICAgICAgICAgICAgICB7IFwiUmVmXCI6IFwiQVdTOjpBY2NvdW50SWRcIiB9LFxuICAgICAgICAgICAgICAgICAgXCI6cmVwb3J0LWdyb3VwL215LXJlcG9ydC1ncm91cFwiLFxuICAgICAgICAgICAgICAgIF1dLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ3NwZWNpZnkgZXhwb3J0Q29uZmlnPVMzIHdoZW4gcHJvdmlkaW5nIGFuIGV4cG9ydEJ1Y2tldCcodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAgIG5ldyBjb2RlYnVpbGQuUmVwb3J0R3JvdXAoc3RhY2ssICdSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgZXhwb3J0QnVja2V0OiBzMy5CdWNrZXQuZnJvbUJ1Y2tldE5hbWUoc3RhY2ssICdCdWNrZXQnLCAnbXktYnVja2V0JyksXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVCdWlsZDo6UmVwb3J0R3JvdXAnLCB7XG4gICAgICAgIFwiVHlwZVwiOiBcIlRFU1RcIixcbiAgICAgICAgXCJFeHBvcnRDb25maWdcIjoge1xuICAgICAgICAgIFwiRXhwb3J0Q29uZmlnVHlwZVwiOiBcIlMzXCIsXG4gICAgICAgICAgXCJTM0Rlc3RpbmF0aW9uXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0XCI6IFwibXktYnVja2V0XCIsXG4gICAgICAgICAgICBcIkVuY3J5cHRpb25LZXlcIjogQUJTRU5ULFxuICAgICAgICAgICAgXCJFbmNyeXB0aW9uRGlzYWJsZWRcIjogQUJTRU5ULFxuICAgICAgICAgICAgXCJQYWNrYWdpbmdcIjogQUJTRU5ULFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSk7XG5cbiAgICAgIHRlc3QuZG9uZSgpO1xuICAgIH0sXG5cbiAgICAnc3BlY2lmeSBlbmNyeXB0aW9uS2V5IGluIEV4cG9ydENvbmZpZy5TM0Rlc3RpbmF0aW9uIGlmIGV4cG9ydEJ1Y2tldCBoYXMgYSBLZXknKHRlc3Q6IFRlc3QpIHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgICBuZXcgY29kZWJ1aWxkLlJlcG9ydEdyb3VwKHN0YWNrLCAnUmVwb3J0R3JvdXAnLCB7XG4gICAgICAgIGV4cG9ydEJ1Y2tldDogczMuQnVja2V0LmZyb21CdWNrZXRBdHRyaWJ1dGVzKHN0YWNrLCAnQnVja2V0Jywge1xuICAgICAgICAgIGJ1Y2tldE5hbWU6ICdteS1idWNrZXQnLFxuICAgICAgICAgIGVuY3J5cHRpb25LZXk6IGttcy5LZXkuZnJvbUtleUFybihzdGFjaywgJ0tleScsXG4gICAgICAgICAgICAnYXJuOmF3czprbXM6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjprZXkvbXkta2V5JyksXG4gICAgICAgIH0pLFxuICAgICAgICB6aXBFeHBvcnQ6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHN0YWNrKS50byhoYXZlUmVzb3VyY2VMaWtlKCdBV1M6OkNvZGVCdWlsZDo6UmVwb3J0R3JvdXAnLCB7XG4gICAgICAgIFwiVHlwZVwiOiBcIlRFU1RcIixcbiAgICAgICAgXCJFeHBvcnRDb25maWdcIjoge1xuICAgICAgICAgIFwiRXhwb3J0Q29uZmlnVHlwZVwiOiBcIlMzXCIsXG4gICAgICAgICAgXCJTM0Rlc3RpbmF0aW9uXCI6IHtcbiAgICAgICAgICAgIFwiQnVja2V0XCI6IFwibXktYnVja2V0XCIsXG4gICAgICAgICAgICBcIkVuY3J5cHRpb25EaXNhYmxlZFwiOiBmYWxzZSxcbiAgICAgICAgICAgIFwiRW5jcnlwdGlvbktleVwiOiBcImFybjphd3M6a21zOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6a2V5L215LWtleVwiLFxuICAgICAgICAgICAgXCJQYWNrYWdpbmdcIjogXCJaSVBcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuXG4gICAgICB0ZXN0LmRvbmUoKTtcbiAgICB9LFxuXG4gICAgJ2dldCBjcmVhdGVkIHdpdGggUmVtb3ZhbFBvbGljeS5SRVRBSU4gYnkgZGVmYXVsdCcodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAgIG5ldyBjb2RlYnVpbGQuUmVwb3J0R3JvdXAoc3RhY2ssICdSZXBvcnRHcm91cCcpO1xuXG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgXCJEZWxldGlvblBvbGljeVwiOiBcIlJldGFpblwiLFxuICAgICAgICBcIlVwZGF0ZVJlcGxhY2VQb2xpY3lcIjogXCJSZXRhaW5cIixcbiAgICAgIH0sIFJlc291cmNlUGFydC5Db21wbGV0ZURlZmluaXRpb24pKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcblxuICAgICdjYW4gYmUgY3JlYXRlZCB3aXRoIFJlbW92YWxQb2xpY3kuREVTVFJPWScodGVzdDogVGVzdCkge1xuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG5cbiAgICAgIG5ldyBjb2RlYnVpbGQuUmVwb3J0R3JvdXAoc3RhY2ssICdSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3Qoc3RhY2spLnRvKGhhdmVSZXNvdXJjZUxpa2UoJ0FXUzo6Q29kZUJ1aWxkOjpSZXBvcnRHcm91cCcsIHtcbiAgICAgICAgXCJEZWxldGlvblBvbGljeVwiOiBcIkRlbGV0ZVwiLFxuICAgICAgICBcIlVwZGF0ZVJlcGxhY2VQb2xpY3lcIjogXCJEZWxldGVcIixcbiAgICAgIH0sIFJlc291cmNlUGFydC5Db21wbGV0ZURlZmluaXRpb24pKTtcblxuICAgICAgdGVzdC5kb25lKCk7XG4gICAgfSxcbiAgfSxcbn07XG4iXX0=